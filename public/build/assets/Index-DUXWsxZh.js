/* empty css             */import{b as L,E as T,a as j}from"./el-main-DnE_WVfA.js";import{u as W,a as Z,P as J,_ as H,I as K,E as Q,b as X}from"./useInfiniteScroll-ZkY99TTV.js";import{A as D}from"./App-CwtvLzas.js";import{m as G,o as u,c as v,w as y,a as s,u as i,Z as ee,f as ae,p as te,F as ie,b as ne,g}from"./app-Ugu9MV1i.js";import{u as oe,V}from"./UserStore-C8M5ePU2.js";import{u as se}from"./helpers-B8x154q-.js";import{a as m}from"./api-Bd-0tR9N.js";import"./plugin-vue_export-helper-CdpdoBDk.js";import"./index-Dijvbhd9.js";import"./use-global-config-DhWqsYnV.js";import"./event-BGsaiZ_k.js";import"./el-popper-Boe1LXo1.js";import"./el-button-D_FPi3ga.js";import"./TextEditor-aiXH6Ze7.js";import"./el-popconfirm-BYyqJqMD.js";/* empty css                   */import"./el-avatar-Bp1R2_MA.js";import"./el-col-Cl4KUwwf.js";import"./ApplicationLogo-g_5VhhGv.js";const He={__name:"Index",props:{ideas:{type:Object}},setup(le){const w=G(null),{ideaForm:I,ideaCommentForm:x,resetForm:k,showIdeaModal:b,showIdeaEditModal:h,showIdeaCommentModal:S,ideaModalVisible:q,ideaEditModalVisible:U,ideaCommentModalVisible:z}=W(),{info:l,success:_}=se(),{items:f}=Z("ideas",w),o=oe(),t=G(!1),d=(e,a=!1)=>{const n=f.value.findIndex(r=>r.id===e.id);n!==-1&&!a?f.value[n]=e:a?f.value.splice(n,1):f.value.unshift(e)},M=async(e,a)=>{e&&await e.validate((n,r)=>{n&&(t.value=!0,a.id!==null?F(a):B(a))})},F=async e=>{await m.ideas.edit(e.id,{title:e.title,description:e.description}).then(a=>{d(a.data.idea),h(!1),_("G'oya muvaffaqiyatli tahrirlandi")}).finally(()=>{t.value=!1})},B=async e=>{await m.ideas.add({title:e.title,description:e.description}).then(a=>{d(a.data.idea),b(!1),_("G'oya muvaffaqiyatli qo'shildi")}).finally(()=>{t.value=!1})},N=async e=>{t.value=!0,await m.ideas.delete(e).then(a=>{d(a.data.idea,!0),l("G'oya muvaffaqiyatli o'chirildi")}).finally(()=>{t.value=!1})};async function O(e){C()&&!o.hasUpvotedIdea(e)&&!t.value&&await E(e,V.UP)}async function P(e){C()&&!o.hasDownvotedIdea(e)&&!t.value&&await E(e,V.DOWN)}async function A(e){o.isGuest?l("G'oyalarni saqlash uchun tizimga kiring"):t.value||(t.value=!0,await m.ideas.favorite(e.id).then(a=>{d(a.data.idea),o.updateUserFavorites(a.data.user_favorites),o.hasFavoritedIdea(e)?_("G'oya muvaffaqiyatli saqlandi"):l("G'oya sizning sevimlilar ro'yxatingizdan o'chirildi")}).finally(()=>{t.value=!1}))}async function R(e,a){if(o.isGuest)l("Iltimos, sharh qoldirish uchun tizimga kiring");else if(!t.value){if(!e)return;await e.validate(async(n,r)=>{n&&(t.value=!0,await m.ideas.comment(a.idea.id,{body:a.body,parent_id:a.parent_id??null}).then(p=>{d(p.data.idea),o.updateUserComments(p.data.user_comments)}).finally(()=>{t.value=!1}))})}}function Y(e){}function C(){return o.isGuest?(l("Ovoz berish uchun tizimga kiring"),!1):!0}async function E(e,a){t.value=!0,await m.ideas.vote(e.id,{type:a}).then(n=>{d(n.data.idea),o.updateUserVotes(n.data.user_votes),l("Ovoz berildi")}).finally(()=>{t.value=!1})}return(e,a)=>{const n=Q,r=L,p=T,$=j;return u(),v(D,null,{header:y(()=>[s(i(ee),{title:"G'oyalar"})]),default:y(()=>[s(n,{right:50,bottom:50,"visibility-height":300}),s($,null,{default:y(()=>[s(r,{class:"hidden md:block"}),s(p,null,{default:y(()=>[s(J,{onShowModal:i(b)},null,8,["onShowModal"]),(u(!0),ae(ie,null,te(i(f),c=>(u(),v(X,{key:c.id,idea:c,submitting:t.value,onShowEditModalHandler:i(h),onShowCommentModalHandler:i(S),onDeleteIdeaHandler:N,onVoteUpHandler:O,onVoteDownHandler:P,onFavoriteIdeaHandler:A,onSendIdeaHandler:Y,class:"mb-2"},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler"]))),128)),ne("div",{ref_key:"landmark",ref:w},null,512)]),_:1}),s(r,{class:"hidden lg:block"})]),_:1}),i(q)?(u(),v(H,{key:0,"idea-form":i(I),submitting:t.value,title:"Yangi g'oya","submit-button-text":"Yuborish",onClose:a[0]||(a[0]=c=>i(b)(!1)),onSubmit:M,onReset:i(k)},null,8,["idea-form","submitting","onReset"])):g("",!0),i(U)?(u(),v(H,{key:1,"idea-form":i(I),submitting:t.value,title:"G'oyani tahrirlash","submit-button-text":"Saqlash",onClose:a[1]||(a[1]=c=>i(h)(!1)),onSubmit:M,onReset:i(k)},null,8,["idea-form","submitting","onReset"])):g("",!0),i(z)?(u(),v(K,{key:2,"idea-comment-form":i(x),submitting:t.value,"submit-button-text":"Yuborish",onClose:a[2]||(a[2]=c=>i(S)(!1)),onSubmit:R},null,8,["idea-comment-form","submitting"])):g("",!0)]),_:1})}}};export{He as default};
