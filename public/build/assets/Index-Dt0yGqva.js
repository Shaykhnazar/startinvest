/* empty css             */import{b as Y,a as W,E as Z}from"./el-main-BUru61ID.js";import{u as J,a as K,P as Q,_ as x,I as X,b as ee,E as ae,c as ie}from"./IdeaDeleteModal-BUf4ak4X.js";import{m as G,o as m,c as v,w as h,a as n,u as i,Z as te,f as oe,p as se,F as ne,b as le,g,h as de,y as re}from"./app-D1EimZBk.js";import{A as ue}from"./App-BgcbzAd1.js";import{u as me,V as U}from"./UserStore-D6bwQrhd.js";import{u as fe}from"./helpers-B9RffSSF.js";import{a as f}from"./api-BhzAm-Zs.js";import"./plugin-vue_export-helper-DPptxW9G.js";import"./index-auauYYXy.js";import"./use-global-config-DqgFKRRu.js";import"./event-C5SCMw-n.js";import"./el-popper-BvrAWh6L.js";import"./el-button-BVgFOgCY.js";import"./TextEditor-DhAtgb3u.js";/* empty css                   */import"./el-avatar-BFnSoRhk.js";import"./ApplicationLogo-BramxRBp.js";const Ue={__name:"Index",props:{ideas:{type:Object}},setup(ce){const I=G(null),{ideaForm:S,ideaCommentForm:q,ideaDeleteModalProps:z,resetForm:M,showIdeaModal:y,showIdeaEditModal:b,showIdeaCommentModal:k,showIdeaDeleteModal:w,ideaModalVisible:F,ideaEditModalVisible:P,ideaCommentModalVisible:$,ideaDeleteModalVisible:C}=J(),{info:l,success:_}=fe(),{items:c}=K("ideas",I),s=me(),t=G(!1),d=(e,a=!1)=>{const o=c.findIndex(r=>r.id===e.id);o!==-1&&!a?c[o]=e:a?c.splice(o,1):c.unshift(e)},H=async(e,a)=>{e&&await e.validate((o,r)=>{o&&(t.value=!0,a.id!==null?B(a):N(a))})},B=async e=>{await f.ideas.edit(e.id,{title:e.title,description:e.description}).then(a=>{d(a.data.idea),b(!1),_("G'oya muvaffaqiyatli tahrirlandi")}).finally(()=>{t.value=!1})},N=async e=>{await f.ideas.add({title:e.title,description:e.description}).then(a=>{d(a.data.idea),y(!1),_("G'oya muvaffaqiyatli qo'shildi")}).finally(()=>{t.value=!1})},O=async e=>{t.value=!0,await f.ideas.delete(e).then(a=>{d(a.data.idea,!0),w(!1),l("G'oya muvaffaqiyatli o'chirildi")}).finally(()=>{t.value=!1})};async function A(e){E()&&!s.hasUpvotedIdea(e)&&!t.value&&await V(e,U.UP)}async function D(e){E()&&!s.hasDownvotedIdea(e)&&!t.value&&await V(e,U.DOWN)}async function R(e){s.isGuest?l("G'oyalarni saqlash uchun tizimga kiring"):t.value||(t.value=!0,await f.ideas.favorite(e.id).then(a=>{d(a.data.idea),s.updateUserFavorites(a.data.user_favorites),s.hasFavoritedIdea(e)?_("G'oya muvaffaqiyatli saqlandi"):l("G'oya sizning sevimlilar ro'yxatingizdan o'chirildi")}).finally(()=>{t.value=!1}))}async function j(e,a){if(s.isGuest)l("Iltimos, sharh qoldirish uchun tizimga kiring");else if(!t.value){if(!e)return;await e.validate(async(o,r)=>{o&&(t.value=!0,await f.ideas.comment(a.idea.id,{body:a.body,parent_id:a.parent_id??null}).then(p=>{d(p.data.idea),s.updateUserComments(p.data.user_comments)}).finally(()=>{t.value=!1}))})}}function L(e){}function E(){return s.isGuest?(l("Ovoz berish uchun tizimga kiring"),!1):!0}async function V(e,a){t.value=!0,await f.ideas.vote(e.id,{type:a}).then(o=>{d(o.data.idea),s.updateUserVotes(o.data.user_votes),l("Ovoz berildi")}).finally(()=>{t.value=!1})}return(e,a)=>{const o=ae,r=Y,p=W,T=Z;return m(),v(ue,null,{header:h(()=>[n(i(te),{title:"G'oyalar"})]),default:h(()=>[n(o,{right:50,bottom:50,"visibility-height":300}),n(T,{class:"justify-center"},{default:h(()=>[n(r,{class:"hidden md:block"}),n(p,{class:"max-w-[50rem]"},{default:h(()=>[n(Q,{onShowModal:i(y)},null,8,["onShowModal"]),(m(!0),oe(ne,null,se(i(c),u=>(m(),v(ie,{key:u.id,idea:u,submitting:t.value,onShowEditModalHandler:i(b),onShowCommentModalHandler:i(k),onShowDeleteModalHandler:i(w),onVoteUpHandler:A,onVoteDownHandler:D,onFavoriteIdeaHandler:R,onSendIdeaHandler:L,class:"mb-2"},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler","onShowDeleteModalHandler"]))),128)),le("div",{ref_key:"landmark",ref:I},null,512)]),_:1}),n(r,{class:"hidden lg:block"})]),_:1}),i(F)?(m(),v(x,{key:0,"idea-form":i(S),submitting:t.value,title:"Yangi g'oya","submit-button-text":"Ulashish",onClose:a[0]||(a[0]=u=>i(y)(!1)),onSubmit:H,onReset:i(M)},null,8,["idea-form","submitting","onReset"])):g("",!0),i(P)?(m(),v(x,{key:1,"idea-form":i(S),submitting:t.value,title:"G'oyani tahrirlash","submit-button-text":"Saqlash",onClose:a[1]||(a[1]=u=>i(b)(!1)),onSubmit:H,onReset:i(M)},null,8,["idea-form","submitting","onReset"])):g("",!0),i($)?(m(),v(X,{key:2,"idea-comment-form":i(q),submitting:t.value,"submit-button-text":"Ulashish",onClose:a[2]||(a[2]=u=>i(k)(!1)),onSubmit:j},null,8,["idea-comment-form","submitting"])):g("",!0),de(n(ee,{"is-visible":i(C),idea:i(z).idea,onClose:a[3]||(a[3]=u=>i(w)(!1)),onDeleteIdeaHandler:O},null,8,["is-visible","idea"]),[[re,i(C)]])]),_:1})}}};export{Ue as default};
