import"./base-BnHKtfUZ.js";import{E as Y,a as Z}from"./el-main-C9b0JVo0.js";import{u as q,E as z}from"./useInfiniteScroll-B4wMbyNf.js";import"./el-col-DLCr95UZ.js";import"./App.vue_vue_type_style_index_0_scoped_7af6d541_lang-BmyU6Swq.js";import"./el-popper-s9hyRtqC.js";import{p as H,o as r,f as V,a as u,u as o,w as _,m as P,Z as J,l as K,b as Q,c as p,g as w}from"./app-ClmI52mw.js";import{u as X,V as x}from"./UserStore-CK0gHu6-.js";import{u as D,P as ee,_ as U,I as te,a as ae}from"./IdeaCommentModal-Ch3D6_TS.js";import{u as oe}from"./helpers-C_LPfVQu.js";import{a as m}from"./api-ZRpqv2Ff.js";import{_ as ie}from"./AuthenticatedLayout-BFbyF9WM.js";import"./use-form-item-6cDW_BaZ.js";import"./error-Cq9Fpw4b.js";/* empty css                   */import"./el-button-DFkX7kJl.js";import"./index-C6f36V5c.js";import"./el-form-item-Dp_brv3c.js";import"./el-input-BraCgkhD.js";import"./el-divider-DsbTOonr.js";import"./el-popconfirm-DL3W8gCW.js";import"./ApplicationLogo-WIRcuAMn.js";const He={__name:"Index",props:{ideas:{type:Object}},setup(se){const S=H(null),{ideaForm:g,ideaCommentForm:N,resetForm:h,showIdeaModal:y,showIdeaEditModal:b,showIdeaCommentModal:M,ideaModalVisible:B,ideaEditModalVisible:F,ideaCommentModalVisible:$}=D(),{info:n,success:I}=oe(),{items:f}=q("ideas",S),s=X(),a=H(!1),l=(e,t=!1)=>{const i=f.value.findIndex(d=>d.id===e.id);i!==-1&&!t?f.value[i]=e:t?f.value.splice(i,1):f.value.unshift(e)},k=async(e,t)=>{e&&await e.validate((i,d)=>{i&&(a.value=!0,t.id!==null?R(t):G(t))})},R=async e=>{await m.ideas.edit(e.id,{title:e.title,description:e.description}).then(t=>{l(t.data.idea),b(!1),I("Idea edited successfully")}).finally(()=>{a.value=!1})},G=async e=>{await m.ideas.add({title:e.title,description:e.description}).then(t=>{l(t.data.idea),y(!1),I("Idea added successfully")}).finally(()=>{a.value=!1})},O=async e=>{a.value=!0,await m.ideas.delete(e).then(t=>{l(t.data.idea,!0),n("Idea deleted successfully")}).finally(()=>{a.value=!1})};async function L(e){C()&&!s.hasUpvotedIdea(e)&&!a.value&&await E(e,x.UP)}async function T(e){C()&&!s.hasDownvotedIdea(e)&&!a.value&&await E(e,x.DOWN)}async function j(e){s.isGuest?n("Please login to save ideas"):a.value||(a.value=!0,await m.ideas.favorite(e.id).then(t=>{l(t.data.idea),s.updateUserFavorites(t.data.user_favorites),s.hasFavoritedIdea(e)?I("Idea saved successfully"):n("Idea removed from your favorites")}).finally(()=>{a.value=!1}))}async function A(e,t){if(s.isGuest)n("Please login to comment");else if(!a.value){if(!e)return;await e.validate(async(i,d)=>{i?(a.value=!0,await m.ideas.comment(t.idea.id,{body:t.body,parent_id:t.parent_id??null}).then(v=>{l(v.data.idea),s.updateUserComments(v.data.user_comments)}).finally(()=>{a.value=!1})):console.log("error submit!",d)})}}function W(e){}function C(){return s.isGuest?(n("Please login to vote"),!1):!0}async function E(e,t){a.value=!0,await m.ideas.vote(e.id,{type:t}).then(i=>{l(i.data.idea),s.updateUserVotes(i.data.user_votes),n("Voted successfully")}).finally(()=>{a.value=!1})}return(e,t)=>{const i=z,d=Y,v=Z;return r(),V(P,null,[u(o(J),{title:"My Ideas"}),u(ie,null,{default:_(()=>[u(i,{right:50,bottom:50}),u(v,null,{default:_(()=>[u(d,null,{default:_(()=>[u(ee,{onShowModal:o(y)},null,8,["onShowModal"]),(r(!0),V(P,null,K(o(f),c=>(r(),p(ae,{key:c.id,idea:c,submitting:a.value,onShowEditModalHandler:o(b),onShowCommentModalHandler:o(M),onDeleteIdeaHandler:O,onVoteUpHandler:L,onVoteDownHandler:T,onFavoriteIdeaHandler:j,onSendIdeaHandler:W},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler"]))),128)),Q("div",{ref_key:"landmark",ref:S},null,512)]),_:1})]),_:1}),o(B)?(r(),p(U,{key:0,"idea-form":o(g),submitting:a.value,title:"New Idea","submit-button-text":"Post",onClose:t[0]||(t[0]=c=>o(y)(!1)),onSubmit:k,onReset:o(h)},null,8,["idea-form","submitting","onReset"])):w("",!0),o(F)?(r(),p(U,{key:1,"idea-form":o(g),submitting:a.value,title:"Edit Idea","submit-button-text":"Save",onClose:t[1]||(t[1]=c=>o(b)(!1)),onSubmit:k,onReset:o(h)},null,8,["idea-form","submitting","onReset"])):w("",!0),o($)?(r(),p(te,{key:2,"idea-comment-form":o(N),submitting:a.value,"submit-button-text":"Post",onClose:t[2]||(t[2]=c=>o(M)(!1)),onSubmit:A},null,8,["idea-comment-form","submitting"])):w("",!0)]),_:1})],64)}}};export{He as default};
