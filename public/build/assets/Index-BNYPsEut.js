import"./base-BSrQRjeB.js";import{E as A,a as L}from"./el-main-nA3g-Ve4.js";import{E as T}from"./el-backtop-CYXXXy3P.js";import{A as j}from"./App-CmP6x9zu.js";import{m as H,o as d,c,w as y,a as v,u as i,Z as W,f as Z,p as J,F as K,b as Q,g as w}from"./app-CUnbgRqf.js";import{u as X,a as D,P as ee,_ as V,I as ae,b as te}from"./useInfiniteScroll-CSnLBKHW.js";import{u as ie,V as x}from"./UserStore-CB2ue7Uj.js";import{u as oe}from"./helpers-CLpwuXte.js";import{a as r}from"./api-QEF-lEob.js";import"./index-B2NAtYRT.js";import"./use-global-config-DFyT_utX.js";import"./error-Cq9Fpw4b.js";import"./ApplicationLogo-ByyaMjyt.js";import"./el-col-M6gEUcxB.js";import"./el-input-BV59qbO9.js";import"./el-popper-lMO85E7k.js";import"./el-divider-CGWulMB1.js";import"./el-tooltip-JyDEknex.js";const ke={__name:"Index",props:{ideas:{type:Object}},setup(ne){const _=H(null),{ideaForm:I,ideaCommentForm:G,resetForm:S,showIdeaModal:h,showIdeaEditModal:b,showIdeaCommentModal:k,ideaModalVisible:q,ideaEditModalVisible:U,ideaCommentModalVisible:z}=X(),{info:s,success:g}=oe(),{items:u}=D("ideas",_),n=ie(),t=H(!1),l=(e,a=!1)=>{const o=u.value.findIndex(m=>m.id===e.id);o!==-1&&!a?u.value[o]=e:a?u.value.splice(o,1):u.value.unshift(e)},M=async(e,a)=>{e&&await e.validate((o,m)=>{o&&(t.value=!0,a.id!==null?F(a):B(a))})},F=async e=>{await r.ideas.edit(e.id,{title:e.title,description:e.description}).then(a=>{l(a.data.idea),b(!1),g("G'oya muvaffaqiyatli tahrirlandi")}).finally(()=>{t.value=!1})},B=async e=>{await r.ideas.add({title:e.title,description:e.description}).then(a=>{l(a.data.idea),h(!1),g("G'oya muvaffaqiyatli qo'shildi")}).finally(()=>{t.value=!1})},N=async e=>{t.value=!0,await r.ideas.delete(e).then(a=>{l(a.data.idea,!0),s("G'oya muvaffaqiyatli o'chirildi")}).finally(()=>{t.value=!1})};async function P(e){C()&&!n.hasUpvotedIdea(e)&&!t.value&&await E(e,x.UP)}async function O(e){C()&&!n.hasDownvotedIdea(e)&&!t.value&&await E(e,x.DOWN)}async function R(e){n.isGuest?s("Iltimos, g'oyalarni saqlash uchun tizimga kiring"):t.value||(t.value=!0,await r.ideas.favorite(e.id).then(a=>{l(a.data.idea),n.updateUserFavorites(a.data.user_favorites),n.hasFavoritedIdea(e)?g("G'oya muvaffaqiyatli saqlandi"):s("G'oya sizning sevimlilar ro'yxatingizdan o'chirildi")}).finally(()=>{t.value=!1}))}async function Y(e,a){if(n.isGuest)s("Iltimos, sharh qoldirish uchun tizimga kiring");else if(!t.value){if(!e)return;await e.validate(async(o,m)=>{o&&(t.value=!0,await r.ideas.comment(a.idea.id,{body:a.body,parent_id:a.parent_id??null}).then(p=>{l(p.data.idea),n.updateUserComments(p.data.user_comments)}).finally(()=>{t.value=!1}))})}}function $(e){}function C(){return n.isGuest?(s("Iltimos, ovoz berish uchun tizimga kiring"),!1):!0}async function E(e,a){t.value=!0,await r.ideas.vote(e.id,{type:a}).then(o=>{l(o.data.idea),n.updateUserVotes(o.data.user_votes),s("Ovoz berildi")}).finally(()=>{t.value=!1})}return(e,a)=>{const o=T,m=A,p=L;return d(),c(j,null,{header:y(()=>[v(i(W),{title:"G'oyalar"})]),default:y(()=>[v(o,{right:50,bottom:50,"visibility-height":300}),v(p,null,{default:y(()=>[v(m,null,{default:y(()=>[v(ee,{onShowModal:i(h)},null,8,["onShowModal"]),(d(!0),Z(K,null,J(i(u),f=>(d(),c(te,{key:f.id,idea:f,submitting:t.value,onShowEditModalHandler:i(b),onShowCommentModalHandler:i(k),onDeleteIdeaHandler:N,onVoteUpHandler:P,onVoteDownHandler:O,onFavoriteIdeaHandler:R,onSendIdeaHandler:$},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler"]))),128)),Q("div",{ref_key:"landmark",ref:_},null,512)]),_:1})]),_:1}),i(q)?(d(),c(V,{key:0,"idea-form":i(I),submitting:t.value,title:"Yangi g'oya","submit-button-text":"Yuborish",onClose:a[0]||(a[0]=f=>i(h)(!1)),onSubmit:M,onReset:i(S)},null,8,["idea-form","submitting","onReset"])):w("",!0),i(U)?(d(),c(V,{key:1,"idea-form":i(I),submitting:t.value,title:"G'oyani tahrirlash","submit-button-text":"Saqlash",onClose:a[1]||(a[1]=f=>i(b)(!1)),onSubmit:M,onReset:i(S)},null,8,["idea-form","submitting","onReset"])):w("",!0),i(z)?(d(),c(ae,{key:2,"idea-comment-form":i(G),submitting:t.value,"submit-button-text":"Yuborish",onClose:a[2]||(a[2]=f=>i(k)(!1)),onSubmit:Y},null,8,["idea-comment-form","submitting"])):w("",!0)]),_:1})}}};export{ke as default};
