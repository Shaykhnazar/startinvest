import"./base-Dyg8xLVB.js";import{E as j,a as W}from"./el-main-DhTocUyQ.js";import{u as Y,E as Z}from"./useInfiniteScroll-H6WEGJFh.js";import{p as H,o as r,c,w as y,a as p,u as o,Z as q,f as z,l as J,m as K,b as Q,g as _}from"./app-BaX9XRKS.js";import{A as X}from"./App-D0RcdsqS.js";import{u as D,P as ee,_ as V,I as te,a as ae}from"./IdeaCommentModal-Crcjt8PP.js";import{u as oe,V as P}from"./UserStore-CRVYXI6B.js";import{u as ie}from"./helpers-DGJMje7s.js";import{a as u}from"./api-C-Ezajxb.js";import"./use-form-item-Dx1Pfq_H.js";import"./el-col-BhSxEXRF.js";import"./error-Cq9Fpw4b.js";import"./el-popper-BTPNSr8J.js";/* empty css                   */import"./App.vue_vue_type_style_index_0_scoped_9c70e886_lang-O0BxIv3e.js";import"./ApplicationLogo-CkEh5Ubc.js";import"./index-bFDDEf2k.js";import"./el-button-CPBNj3Lk.js";import"./index-BheFElWv.js";import"./el-form-item-wy6Cl2zw.js";import"./el-input-CFTdmLug.js";import"./el-divider-N4HOg8Bc.js";import"./el-popconfirm-B1UA3qrx.js";const Ve={__name:"Index",props:{ideas:{type:Object}},setup(se){const h=H(null),{ideaForm:S,ideaCommentForm:x,resetForm:g,showIdeaModal:b,showIdeaEditModal:I,showIdeaCommentModal:M,ideaModalVisible:U,ideaEditModalVisible:N,ideaCommentModalVisible:B}=D(),{info:n,success:w}=ie(),{items:m}=Y("ideas",h),s=oe(),a=H(!1),l=(e,t=!1)=>{const i=m.value.findIndex(d=>d.id===e.id);i!==-1&&!t?m.value[i]=e:t?m.value.splice(i,1):m.value.unshift(e)},k=async(e,t)=>{e&&await e.validate((i,d)=>{i&&(a.value=!0,t.id!==null?F(t):R(t))})},F=async e=>{await u.ideas.edit(e.id,{title:e.title,description:e.description}).then(t=>{l(t.data.idea),I(!1),w("Idea edited successfully")}).finally(()=>{a.value=!1})},R=async e=>{await u.ideas.add({title:e.title,description:e.description}).then(t=>{l(t.data.idea),b(!1),w("Idea added successfully")}).finally(()=>{a.value=!1})},$=async e=>{a.value=!0,await u.ideas.delete(e).then(t=>{l(t.data.idea,!0),n("Idea deleted successfully")}).finally(()=>{a.value=!1})};async function A(e){C()&&!s.hasUpvotedIdea(e)&&!a.value&&await E(e,P.UP)}async function G(e){C()&&!s.hasDownvotedIdea(e)&&!a.value&&await E(e,P.DOWN)}async function O(e){s.isGuest?n("Please login to save ideas"):a.value||(a.value=!0,await u.ideas.favorite(e.id).then(t=>{l(t.data.idea),s.updateUserFavorites(t.data.user_favorites),s.hasFavoritedIdea(e)?w("Idea saved successfully"):n("Idea removed from your favorites")}).finally(()=>{a.value=!1}))}async function L(e,t){if(s.isGuest)n("Please login to comment");else if(!a.value){if(!e)return;await e.validate(async(i,d)=>{i?(a.value=!0,await u.ideas.comment(t.idea.id,{body:t.body,parent_id:t.parent_id??null}).then(v=>{l(v.data.idea),s.updateUserComments(v.data.user_comments)}).finally(()=>{a.value=!1})):console.log("error submit!",d)})}}function T(e){}function C(){return s.isGuest?(n("Please login to vote"),!1):!0}async function E(e,t){a.value=!0,await u.ideas.vote(e.id,{type:t}).then(i=>{l(i.data.idea),s.updateUserVotes(i.data.user_votes),n("Voted successfully")}).finally(()=>{a.value=!1})}return(e,t)=>{const i=Z,d=j,v=W;return r(),c(X,null,{header:y(()=>[p(o(q),{title:"Ideas"})]),default:y(()=>[p(i,{right:50,bottom:50}),p(v,null,{default:y(()=>[p(d,null,{default:y(()=>[p(ee,{onShowModal:o(b)},null,8,["onShowModal"]),(r(!0),z(K,null,J(o(m),f=>(r(),c(ae,{key:f.id,idea:f,submitting:a.value,onShowEditModalHandler:o(I),onShowCommentModalHandler:o(M),onDeleteIdeaHandler:$,onVoteUpHandler:A,onVoteDownHandler:G,onFavoriteIdeaHandler:O,onSendIdeaHandler:T},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler"]))),128)),Q("div",{ref_key:"landmark",ref:h},null,512)]),_:1})]),_:1}),o(U)?(r(),c(V,{key:0,"idea-form":o(S),submitting:a.value,title:"New Idea","submit-button-text":"Post",onClose:t[0]||(t[0]=f=>o(b)(!1)),onSubmit:k,onReset:o(g)},null,8,["idea-form","submitting","onReset"])):_("",!0),o(N)?(r(),c(V,{key:1,"idea-form":o(S),submitting:a.value,title:"Edit Idea","submit-button-text":"Save",onClose:t[1]||(t[1]=f=>o(I)(!1)),onSubmit:k,onReset:o(g)},null,8,["idea-form","submitting","onReset"])):_("",!0),o(B)?(r(),c(te,{key:2,"idea-comment-form":o(x),submitting:a.value,"submit-button-text":"Post",onClose:t[2]||(t[2]=f=>o(M)(!1)),onSubmit:L},null,8,["idea-comment-form","submitting"])):_("",!0)]),_:1})}}};export{Ve as default};
