import{m as c,q as b,s as w,o as n,f as i,b as t,F as C,p as k,h as T,v as $,D as F,t as h,g as M,C as U,_ as j,Z as D,ah as v,c as q,w as _,a as y}from"./app-BXc-dLDr.js";import{a as x}from"./api-Bwr7HDcB.js";import{A}from"./App-C9PFPTnY.js";/* empty css             */import"./el-main-BtKZ21-Q.js";import"./plugin-vue_export-helper-BgEZj8Tl.js";import"./UserStore-RByMHB9_.js";import"./ApplicationLogo-C-GyaVwL.js";const B={class:"flex flex-col justify-end h-80"},E={key:0,class:"p-2 ml-auto text-white bg-blue-500 rounded-lg"},H={key:1,class:"p-2 mr-auto bg-gray-200 rounded-lg"},O={class:"flex items-center"},V={key:0,class:"text-gray-700"},K={__name:"ChatComponent",props:{friend:{type:Object,required:!0},currentUser:{type:Object,required:!0}},setup(d){const a=d,s=c([]),o=c(""),u=c(null),p=c(!1),l=c(null);b(s,()=>{U(()=>{u.value.scrollTo({top:u.value.scrollHeight,behavior:"smooth"})})},{deep:!0});const m=async()=>{if(o.value.trim()!=="")try{const e=await x.messages.sendMessage(a.friend.id,{message:o.value});s.value.push(e.data.message),o.value=""}catch(e){console.error("Failed to send message:",e)}},g=()=>{Echo.private(`chat.${a.friend.id}`).whisper("typing",{userID:a.currentUser.id})};return w(async()=>{try{const e=await x.messages.getMessages(a.friend.id);s.value=e.data}catch(e){console.error("Failed to load messages:",e)}Echo.private(`chat.${a.currentUser.id}`).listen("MessageSent",e=>{console.log(e),s.value.push(e.data.message)}).listenForWhisper("typing",e=>{p.value=e.userID===a.friend.id,l.value&&clearTimeout(l.value),l.value=setTimeout(()=>{p.value=!1},1e3)})}),(e,f)=>(n(),i("div",null,[t("div",B,[t("div",{ref_key:"messagesContainer",ref:u,class:"p-4 overflow-y-auto max-h-fit"},[(n(!0),i(C,null,k(s.value,r=>(n(),i("div",{key:r.id,class:"flex items-center mb-2"},[r.sender_id===d.currentUser.id?(n(),i("div",E,h(r.text),1)):(n(),i("div",H,h(r.text),1))]))),128))],512)]),t("div",O,[T(t("input",{type:"text","onUpdate:modelValue":f[0]||(f[0]=r=>o.value=r),onKeydown:g,onKeyup:F(m,["enter"]),placeholder:"Xabar yozing...",class:"flex-1 px-2 py-1 border rounded-lg"},null,544),[[$,o.value]]),t("button",{onClick:m,class:"px-4 py-1 ml-2 text-white bg-blue-500 rounded-lg"}," Yuborish ")]),p.value?(n(),i("small",V,h(d.friend.name)+" yozmoqda... ",1)):M("",!0)]))}},N={components:{App:A,Head:D,ChatComponent:K},props:{friend:Object,currentUser:Object}},z={class:"text-xl font-semibold leading-tight text-gray-800"},I={class:"py-12"},P={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},S={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},L={class:"p-6 bg-white border-b border-gray-200"};function W(d,a,s,o,u,p){const l=v("Head"),m=v("chat-component"),g=v("App");return n(),q(g,null,{header:_(()=>[y(l,{title:"Private chat with "+s.friend.name},null,8,["title"])]),default:_(()=>[t("div",null,[t("h2",z,h(s.friend.name),1),t("div",I,[t("div",P,[t("div",S,[t("div",L,[y(m,{friend:s.friend,"current-user":s.currentUser},null,8,["friend","current-user"])])])])])])]),_:1})}const te=j(N,[["render",W]]);export{te as default};
