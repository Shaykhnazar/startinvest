/* empty css             */import{b as q,a as z,E as J}from"./el-main-DaZawinT.js";import{u as K,a as Q,P as X,I as ee,b as $,c as te,_ as ae,E as ie}from"./IdeaDeleteModal-nJZxfNbW.js";import{A as se}from"./App-meg4ih73.js";import{p as x,o as d,c as f,w as _,a as l,u as a,Z as oe,f as ne,m as de,F as le,b as re,g as w,av as n}from"./app-CnNuEMmT.js";import{u as ue,V as U}from"./UserStore-CylqSXgE.js";import{u as me}from"./helpers-Dg_TcOmu.js";import{a as p}from"./api-DSHBDJK5.js";import"./plugin-vue_export-helper-M7vFY8lq.js";import"./index-DIlMAJ2O.js";import"./use-global-config-BsByRpBn.js";import"./event-COqp9pWW.js";import"./el-popper-CuE4q0dM.js";import"./el-button--wi5tl2p.js";import"./BaseFormTextInput-CHEt0fwN.js";import"./el-input-IJWobApS.js";import"./_initCloneObject-DdJ4LLpi.js";import"./marked.esm-Cv8YM6Xl.js";import"./Popover-CH0fTm9t.js";/* empty css                   */import"./ApplicationLogo-zwZo2Nlb.js";const Pe={__name:"Index",props:{ideas:{type:Object}},setup(ce){const S=x(null),{ideaForm:g,ideaCommentForm:F,ideaDeleteModalProps:P,resetForm:k,showIdeaModal:y,showIdeaEditModal:h,showIdeaCommentModal:C,showIdeaDeleteModal:I,ideaModalVisible:B,ideaEditModalVisible:N,ideaCommentModalVisible:A,ideaDeleteModalVisible:R}=K(),{info:r,success:M}=me(),{items:b}=Q("ideas",S),o=ue(),i=x(!1),u=(e,t=!1)=>{const s=b.findIndex(m=>m.id===e.id);s!==-1&&!t?b[s]=e:t?b.splice(s,1):b.unshift(e)},H=async(e,t)=>{e&&await e.validate((s,m)=>{s&&(i.value=!0,t.id!==null?D(t):G(t))})},D=async e=>{await p.ideas.edit(e.id,{title:e.title,description:e.description}).then(t=>{u(t.data.idea),h(!1),M(n("site.idea.actions.idea_edited_success"))}).finally(()=>{i.value=!1})},G=async e=>{await p.ideas.add({title:e.title,description:e.description}).then(t=>{u(t.data.idea),y(!1),M(n("site.idea.actions.idea_added_success"))}).finally(()=>{i.value=!1})},O=async e=>{i.value=!0,await p.ideas.delete(e).then(t=>{u(t.data.idea,!0),I(!1),r(n("site.idea.actions.idea_deleted_success"))}).finally(()=>{i.value=!1})};async function T(e){E()&&!o.hasUpvotedIdea(e)&&!i.value&&await V(e,U.UP)}async function j(e){E()&&!o.hasDownvotedIdea(e)&&!i.value&&await V(e,U.DOWN)}async function L(e){o.isGuest?r(n("site.idea.actions.login_to_save_idea")):i.value||(i.value=!0,await p.ideas.favorite(e.id).then(t=>{u(t.data.idea),o.updateUserFavorites(t.data.user_favorites),o.hasFavoritedIdea(e)?M(n("site.idea.actions.idea_saved_success")):r(n("site.idea.actions.idea_unsaved"))}).finally(()=>{i.value=!1}))}async function W(e,t){if(o.isGuest)r(n("site.idea.actions.login_to_comment"));else if(!i.value){if(!e)return;await e.validate(async(s,m)=>{s&&(i.value=!0,await p.ideas.comment(t.idea.id,{body:t.body,parent_id:t.parent_id??null}).then(v=>{u(v.data.idea),o.updateUserComments(v.data.user_comments)}).finally(()=>{i.value=!1}))})}}function Y(e){}function E(){return o.isGuest?(r(n("site.idea.actions.login_to_vote")),!1):!0}async function V(e,t){i.value=!0,await p.ideas.vote(e.id,{type:t}).then(s=>{u(s.data.idea),o.updateUserVotes(s.data.user_votes),r(n("site.idea.actions.idea_vote_success"))}).finally(()=>{i.value=!1})}return(e,t)=>{const s=ie,m=q,v=z,Z=J;return d(),f(se,null,{header:_(()=>[l(a(oe),{title:e.$t("site.idea.title")},null,8,["title"])]),default:_(()=>[l(s,{right:50,bottom:50,"visibility-height":300}),l(Z,{class:"justify-center"},{default:_(()=>[l(m,{class:"hidden md:block"}),l(v,{class:"max-w-[50rem]"},{default:_(()=>[l(X,{onShowModal:a(y)},null,8,["onShowModal"]),(d(!0),ne(le,null,de(a(b),c=>(d(),f(ee,{key:c.id,idea:c,submitting:i.value,onShowEditModalHandler:a(h),onShowCommentModalHandler:a(C),onShowDeleteModalHandler:a(I),onVoteUpHandler:T,onVoteDownHandler:j,onFavoriteIdeaHandler:L,onSendIdeaHandler:Y,class:"mb-2"},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler","onShowDeleteModalHandler"]))),128)),re("div",{ref_key:"landmark",ref:S},null,512)]),_:1}),l(m,{class:"hidden lg:block"})]),_:1}),a(B)?(d(),f($,{key:0,"idea-form":a(g),submitting:i.value,title:e.$t("site.idea.modals.new_idea_title"),"submit-button-text":e.$t("site.idea.modals.submit_share_button"),onClose:t[0]||(t[0]=c=>a(y)(!1)),onSubmit:H,onReset:a(k)},null,8,["idea-form","submitting","title","submit-button-text","onReset"])):w("",!0),a(N)?(d(),f($,{key:1,"idea-form":a(g),submitting:i.value,"submit-button-text":e.$t("site.idea.modals.submit_save_button"),onClose:t[1]||(t[1]=c=>a(h)(!1)),onSubmit:H,onReset:a(k)},null,8,["idea-form","submitting","submit-button-text","onReset"])):w("",!0),a(A)?(d(),f(te,{key:2,"idea-comment-form":a(F),submitting:i.value,"submit-button-text":e.$t("site.idea.modals.submit_share_button"),onClose:t[2]||(t[2]=c=>a(C)(!1)),onSubmit:W},null,8,["idea-comment-form","submitting","submit-button-text"])):w("",!0),a(R)?(d(),f(ae,{key:3,idea:a(P).idea,onClose:t[3]||(t[3]=c=>a(I)(!1)),onDeleteIdeaHandler:O},null,8,["idea"])):w("",!0)]),_:1})}}};export{Pe as default};
