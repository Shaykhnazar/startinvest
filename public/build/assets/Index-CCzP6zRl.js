/* empty css             */import{b as Y,a as W,E as Z}from"./el-main-vd2x5eRv.js";import{u as J,a as K,P as Q,_ as V,I as X,b as ee,E as ae,c as te}from"./IdeaDeleteModal-BF-09UKB.js";import{A as ie}from"./App-C9FFldCi.js";import{q as x,o as s,c as f,w as h,a as l,u as t,Z as oe,f as ne,p as se,F as le,b as de,g as y}from"./app-CocX3evV.js";import{u as re,V as G}from"./UserStore-DHDwqWHE.js";import{a as ue}from"./helpers-DZtbvmu_.js";import{a as c}from"./api-B0S9UqwK.js";import"./plugin-vue_export-helper-CT3i79nN.js";import"./index-DqpW-tH4.js";import"./event-Cu9Al0Jx.js";import"./el-popper-B4XFeAhv.js";import"./el-button-CYTNGgD-.js";import"./el-input-DFiHEAPP.js";import"./Popover-CbiLArLe.js";/* empty css                   */import"./ApplicationLogo-BbDUu1iX.js";const Ve={__name:"Index",props:{ideas:{type:Object}},setup(me){const I=x(null),{ideaForm:M,ideaCommentForm:q,ideaDeleteModalProps:U,resetForm:S,showIdeaModal:b,showIdeaEditModal:w,showIdeaCommentModal:k,showIdeaDeleteModal:_,ideaModalVisible:z,ideaEditModalVisible:F,ideaCommentModalVisible:P,ideaDeleteModalVisible:$}=J(),{info:d,success:g}=ue(),{items:v}=K("ideas",I),n=re(),i=x(!1),r=(e,a=!1)=>{const o=v.findIndex(u=>u.id===e.id);o!==-1&&!a?v[o]=e:a?v.splice(o,1):v.unshift(e)},C=async(e,a)=>{e&&await e.validate((o,u)=>{o&&(i.value=!0,a.id!==null?B(a):N(a))})},B=async e=>{await c.ideas.edit(e.id,{title:e.title,description:e.description}).then(a=>{r(a.data.idea),w(!1),g("G'oya muvaffaqiyatli tahrirlandi")}).finally(()=>{i.value=!1})},N=async e=>{await c.ideas.add({title:e.title,description:e.description}).then(a=>{r(a.data.idea),b(!1),g("G'oya muvaffaqiyatli qo'shildi")}).finally(()=>{i.value=!1})},O=async e=>{i.value=!0,await c.ideas.delete(e).then(a=>{r(a.data.idea,!0),_(!1),d("G'oya muvaffaqiyatli o'chirildi")}).finally(()=>{i.value=!1})};async function A(e){H()&&!n.hasUpvotedIdea(e)&&!i.value&&await E(e,G.UP)}async function R(e){H()&&!n.hasDownvotedIdea(e)&&!i.value&&await E(e,G.DOWN)}async function D(e){n.isGuest?d("G'oyalarni saqlash uchun tizimga kiring"):i.value||(i.value=!0,await c.ideas.favorite(e.id).then(a=>{r(a.data.idea),n.updateUserFavorites(a.data.user_favorites),n.hasFavoritedIdea(e)?g("G'oya muvaffaqiyatli saqlandi"):d("G'oya sizning sevimlilar ro'yxatingizdan o'chirildi")}).finally(()=>{i.value=!1}))}async function j(e,a){if(n.isGuest)d("Iltimos, sharh qoldirish uchun tizimga kiring");else if(!i.value){if(!e)return;await e.validate(async(o,u)=>{o&&(i.value=!0,await c.ideas.comment(a.idea.id,{body:a.body,parent_id:a.parent_id??null}).then(p=>{r(p.data.idea),n.updateUserComments(p.data.user_comments)}).finally(()=>{i.value=!1}))})}}function L(e){}function H(){return n.isGuest?(d("Ovoz berish uchun tizimga kiring"),!1):!0}async function E(e,a){i.value=!0,await c.ideas.vote(e.id,{type:a}).then(o=>{r(o.data.idea),n.updateUserVotes(o.data.user_votes),d("Ovoz berildi")}).finally(()=>{i.value=!1})}return(e,a)=>{const o=ae,u=Y,p=W,T=Z;return s(),f(ie,null,{header:h(()=>[l(t(oe),{title:"G'oyalar"})]),default:h(()=>[l(o,{right:50,bottom:50,"visibility-height":300}),l(T,{class:"justify-center"},{default:h(()=>[l(u,{class:"hidden md:block"}),l(p,{class:"max-w-[50rem]"},{default:h(()=>[l(Q,{onShowModal:t(b)},null,8,["onShowModal"]),(s(!0),ne(le,null,se(t(v),m=>(s(),f(te,{key:m.id,idea:m,submitting:i.value,onShowEditModalHandler:t(w),onShowCommentModalHandler:t(k),onShowDeleteModalHandler:t(_),onVoteUpHandler:A,onVoteDownHandler:R,onFavoriteIdeaHandler:D,onSendIdeaHandler:L,class:"mb-2"},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler","onShowDeleteModalHandler"]))),128)),de("div",{ref_key:"landmark",ref:I},null,512)]),_:1}),l(u,{class:"hidden lg:block"})]),_:1}),t(z)?(s(),f(V,{key:0,"idea-form":t(M),submitting:i.value,title:"Yangi g'oya","submit-button-text":"Ulashish",onClose:a[0]||(a[0]=m=>t(b)(!1)),onSubmit:C,onReset:t(S)},null,8,["idea-form","submitting","onReset"])):y("",!0),t(F)?(s(),f(V,{key:1,"idea-form":t(M),submitting:i.value,title:"G'oyani tahrirlash","submit-button-text":"Saqlash",onClose:a[1]||(a[1]=m=>t(w)(!1)),onSubmit:C,onReset:t(S)},null,8,["idea-form","submitting","onReset"])):y("",!0),t(P)?(s(),f(X,{key:2,"idea-comment-form":t(q),submitting:i.value,"submit-button-text":"Ulashish",onClose:a[2]||(a[2]=m=>t(k)(!1)),onSubmit:j},null,8,["idea-comment-form","submitting"])):y("",!0),t($)?(s(),f(ee,{key:3,idea:t(U).idea,onClose:a[3]||(a[3]=m=>t(_)(!1)),onDeleteIdeaHandler:O},null,8,["idea"])):y("",!0)]),_:1})}}};export{Ve as default};
