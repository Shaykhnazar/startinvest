/* empty css             */import{b as Z,E as J,a as K}from"./el-main-BiLF6z3s.js";import{u as Q,a as X,b as ee,P as ae,_ as V,I as te,E as ie,c as oe}from"./IdeaDeleteModal-SiQZ8Kgc.js";import{A as ne}from"./App-Bcyxjjpw.js";import{m as x,o as m,f as G,a as s,w as p,u as t,F as U,Z as se,p as le,b as de,c as h,g}from"./app-TOhbaQ19.js";import{u as re,V as q}from"./UserStore-D4lAcemb.js";import{u as ue}from"./helpers-CwC0Di9K.js";import{a as f}from"./api-Ck_UKqTo.js";import"./plugin-vue_export-helper-CUItRfFD.js";import"./index-CT-6bP4K.js";import"./use-global-config-CO3IU8QP.js";import"./el-col-Cyh3COcP.js";import"./el-popper-BsuHNmpL.js";import"./el-button-BV29s6GR.js";import"./TextEditor-ScDuyLeQ.js";/* empty css                   */import"./el-avatar-BTYSGwYi.js";import"./ApplicationLogo-CEuHbxig.js";const xe={__name:"Index",props:{ideas:{type:Object}},setup(me){const I=x(null),{ideaForm:M,ideaCommentForm:z,ideaDeleteModalProps:F,resetForm:S,showIdeaModal:y,showIdeaEditModal:b,showIdeaCommentModal:k,showIdeaDeleteModal:w,ideaModalVisible:P,ideaEditModalVisible:$,ideaCommentModalVisible:B,ideaDeleteModalVisible:N}=Q(),{info:l,success:_}=ue(),{items:c}=X("ideas",I),n=re(),i=x(!1),d=(e,a=!1)=>{const o=c.findIndex(r=>r.id===e.id);o!==-1&&!a?c[o]=e:a?c.splice(o,1):c.unshift(e)},C=async(e,a)=>{e&&await e.validate((o,r)=>{o&&(i.value=!0,a.id!==null?O(a):A(a))})},O=async e=>{await f.ideas.edit(e.id,{title:e.title,description:e.description}).then(a=>{d(a.data.idea),b(!1),_("G'oya muvaffaqiyatli tahrirlandi")}).finally(()=>{i.value=!1})},A=async e=>{await f.ideas.add({title:e.title,description:e.description}).then(a=>{d(a.data.idea),y(!1),_("G'oya muvaffaqiyatli qo'shildi")}).finally(()=>{i.value=!1})},R=async e=>{i.value=!0,await f.ideas.delete(e).then(a=>{d(a.data.idea,!0),w(!1),l("G'oya muvaffaqiyatli o'chirildi")}).finally(()=>{i.value=!1})};async function D(e){H()&&!n.hasUpvotedIdea(e)&&!i.value&&await E(e,q.UP)}async function j(e){H()&&!n.hasDownvotedIdea(e)&&!i.value&&await E(e,q.DOWN)}async function L(e){n.isGuest?l("G'oyalarni saqlash uchun tizimga kiring"):i.value||(i.value=!0,await f.ideas.favorite(e.id).then(a=>{d(a.data.idea),n.updateUserFavorites(a.data.user_favorites),n.hasFavoritedIdea(e)?_("G'oya muvaffaqiyatli saqlandi"):l("G'oya sizning sevimlilar ro'yxatingizdan o'chirildi")}).finally(()=>{i.value=!1}))}async function T(e,a){if(n.isGuest)l("Iltimos, sharh qoldirish uchun tizimga kiring");else if(!i.value){if(!e)return;await e.validate(async(o,r)=>{o&&(i.value=!0,await f.ideas.comment(a.idea.id,{body:a.body,parent_id:a.parent_id??null}).then(v=>{d(v.data.idea),n.updateUserComments(v.data.user_comments)}).finally(()=>{i.value=!1}))})}}function Y(e){}function H(){return n.isGuest?(l("Ovoz berish uchun tizimga kiring"),!1):!0}async function E(e,a){i.value=!0,await f.ideas.vote(e.id,{type:a}).then(o=>{d(o.data.idea),n.updateUserVotes(o.data.user_votes),l("Ovoz berildi")}).finally(()=>{i.value=!1})}return(e,a)=>{const o=ie,r=Z,v=J,W=K;return m(),G(U,null,[s(ne,null,{header:p(()=>[s(t(se),{title:"G'oyalar"})]),default:p(()=>[s(o,{right:50,bottom:50,"visibility-height":300}),s(W,{class:"justify-center"},{default:p(()=>[s(r,{class:"hidden md:block"}),s(v,{class:"max-w-[50rem]"},{default:p(()=>[s(ae,{onShowModal:t(y)},null,8,["onShowModal"]),(m(!0),G(U,null,le(t(c),u=>(m(),h(oe,{key:u.id,idea:u,submitting:i.value,onShowEditModalHandler:t(b),onShowCommentModalHandler:t(k),onShowDeleteModalHandler:t(w),onVoteUpHandler:D,onVoteDownHandler:j,onFavoriteIdeaHandler:L,onSendIdeaHandler:Y,class:"mb-2"},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler","onShowDeleteModalHandler"]))),128)),de("div",{ref_key:"landmark",ref:I},null,512)]),_:1}),s(r,{class:"hidden lg:block"})]),_:1}),t(P)?(m(),h(V,{key:0,"idea-form":t(M),submitting:i.value,title:"Yangi g'oya","submit-button-text":"Ulashish",onClose:a[0]||(a[0]=u=>t(y)(!1)),onSubmit:C,onReset:t(S)},null,8,["idea-form","submitting","onReset"])):g("",!0),t($)?(m(),h(V,{key:1,"idea-form":t(M),submitting:i.value,title:"G'oyani tahrirlash","submit-button-text":"Saqlash",onClose:a[1]||(a[1]=u=>t(b)(!1)),onSubmit:C,onReset:t(S)},null,8,["idea-form","submitting","onReset"])):g("",!0),t(B)?(m(),h(te,{key:2,"idea-comment-form":t(z),submitting:i.value,"submit-button-text":"Ulashish",onClose:a[2]||(a[2]=u=>t(k)(!1)),onSubmit:T},null,8,["idea-comment-form","submitting"])):g("",!0)]),_:1}),s(ee,{"is-visible":t(N),idea:t(F).idea,onClose:a[3]||(a[3]=u=>t(w)(!1)),onDeleteIdeaHandler:R},null,8,["is-visible","idea"])],64)}}};export{xe as default};
