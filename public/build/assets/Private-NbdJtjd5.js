import{p as c,q as b,s as w,o as r,f as i,b as t,m as k,l as C,i as T,x as $,y as M,t as h,g as U,z as F,_ as j,Z as B,k as f,c as D,w as v,a as y}from"./app-DVfs5GRi.js";import{a as x}from"./api-Ddl1psuA.js";import{_ as E}from"./App-CsFeUQ4B.js";import"./base-CXY8o-8F.js";import"./el-main-Bi73kByu.js";import"./el-col-kE5I33l3.js";import"./AnnouncementBanner.vue_vue_type_style_index_0_scoped_766ac8fa_lang-BV3_aX39.js";import"./el-popper-C5HODc9q.js";import"./UserStore-Dmw2WXzo.js";import"./ApplicationLogo-y_vMdgcC.js";import"./error-Cq9Fpw4b.js";import"./index-CKM1oanw.js";const H={class:"flex flex-col justify-end h-80"},O={key:0,class:"p-2 ml-auto text-white bg-blue-500 rounded-lg"},V={key:1,class:"p-2 mr-auto bg-gray-200 rounded-lg"},q={class:"flex items-center"},A={key:0,class:"text-gray-700"},K={__name:"ChatComponent",props:{friend:{type:Object,required:!0},currentUser:{type:Object,required:!0}},setup(d){const n=d,s=c([]),a=c(""),u=c(null),p=c(!1),l=c(null);b(s,()=>{F(()=>{u.value.scrollTo({top:u.value.scrollHeight,behavior:"smooth"})})},{deep:!0});const m=async()=>{if(a.value.trim()!=="")try{const e=await x.messages.sendMessage(n.friend.id,{message:a.value});s.value.push(e.data.message),a.value=""}catch(e){console.error("Failed to send message:",e)}},_=()=>{Echo.private(`chat.${n.friend.id}`).whisper("typing",{userID:n.currentUser.id})};return w(async()=>{try{const e=await x.messages.getMessages(n.friend.id);s.value=e.data}catch(e){console.error("Failed to load messages:",e)}Echo.private(`chat.${n.currentUser.id}`).listen("MessageSent",e=>{s.value.push(e.data.message)}).listenForWhisper("typing",e=>{p.value=e.userID===n.friend.id,l.value&&clearTimeout(l.value),l.value=setTimeout(()=>{p.value=!1},1e3)})}),(e,g)=>(r(),i("div",null,[t("div",H,[t("div",{ref_key:"messagesContainer",ref:u,class:"p-4 overflow-y-auto max-h-fit"},[(r(!0),i(k,null,C(s.value,o=>(r(),i("div",{key:o.id,class:"flex items-center mb-2"},[o.sender_id===d.currentUser.id?(r(),i("div",O,h(o.text),1)):(r(),i("div",V,h(o.text),1))]))),128))],512)]),t("div",q,[T(t("input",{type:"text","onUpdate:modelValue":g[0]||(g[0]=o=>a.value=o),onKeydown:_,onKeyup:M(m,["enter"]),placeholder:"Type a message...",class:"flex-1 px-2 py-1 border rounded-lg"},null,544),[[$,a.value]]),t("button",{onClick:m,class:"px-4 py-1 ml-2 text-white bg-blue-500 rounded-lg"}," Send ")]),p.value?(r(),i("small",A,h(d.friend.name)+" is typing... ",1)):U("",!0)]))}},N={components:{App:E,Head:B,ChatComponent:K},props:{friend:Object,currentUser:Object}},S={class:"text-xl font-semibold leading-tight text-gray-800"},I={class:"py-12"},P={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},z={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},L={class:"p-6 bg-white border-b border-gray-200"};function W(d,n,s,a,u,p){const l=f("Head"),m=f("chat-component"),_=f("App");return r(),D(_,null,{header:v(()=>[y(l,{title:"Private chat with "+s.friend.name},null,8,["title"])]),default:v(()=>[t("div",null,[t("h2",S,h(s.friend.name),1),t("div",I,[t("div",P,[t("div",z,[t("div",L,[y(m,{friend:s.friend,"current-user":s.currentUser},null,8,["friend","current-user"])])])])])])]),_:1})}const ae=j(N,[["render",W]]);export{ae as default};
