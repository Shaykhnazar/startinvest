import{j as W,k as Y}from"./useNavActiveTab-919294e8.js";import{u as Z,a as z,P as J,_ as H,I as K,b as u,E as Q,c as X,d as D}from"./useInfiniteScroll-73e41803.js";import{q as V,o as r,f as P,a as f,u as s,w as _,F as x,Z as ee,I as te,b as ae,c as y,g as w}from"./app-2315477b.js";import{u as se,V as U}from"./UserStore-0603bc16.js";import{_ as ne}from"./AuthenticatedLayout-28fde368.js";import"./el-icon-0467a0db.js";import"./ApplicationLogo-b493c468.js";const ce={__name:"Index",props:{ideas:{type:Object}},setup(ie){const S=V(null),{ideaForm:g,ideaCommentForm:F,resetForm:h,showIdeaModal:b,showIdeaEditModal:p,showIdeaCommentModal:M,ideaModalVisible:N,ideaEditModalVisible:B,ideaCommentModalVisible:$}=Z(),{info:o,success:I}=D(),{items:m}=z("ideas",S),i=se(),a=V(!1),l=(e,t=!1)=>{const n=m.value.findIndex(d=>d.id===e.id);n!==-1&&!t?m.value[n]=e:t?m.value.splice(n,1):m.value.unshift(e)},k=async(e,t)=>{e&&await e.validate((n,d)=>{n&&(a.value=!0,t.id!==null?R(t):G(t))})},R=async e=>{await u.ideas.edit(e.id,{title:e.title,description:e.description}).then(t=>{l(t.data.idea),p(!1),I("Idea edited successfully")}).finally(()=>{a.value=!1})},G=async e=>{await u.ideas.add({title:e.title,description:e.description}).then(t=>{l(t.data.idea),b(!1),I("Idea added successfully")}).finally(()=>{a.value=!1})},O=async e=>{a.value=!0,await u.ideas.delete(e).then(t=>{l(t.data.idea,!0),o("Idea deleted successfully")}).finally(()=>{a.value=!1})};async function j(e){C()&&!i.hasUpvotedIdea(e)&&!a.value&&await E(e,U.UP)}async function L(e){C()&&!i.hasDownvotedIdea(e)&&!a.value&&await E(e,U.DOWN)}async function T(e){i.isGuest?o("Please login to save ideas"):a.value||(a.value=!0,await u.ideas.favorite(e.id).then(t=>{l(t.data.idea),i.updateUserFavorites(t.data.user_favorites),i.hasFavoritedIdea(e)?I("Idea saved successfully"):o("Idea removed from your favorites")}).finally(()=>{a.value=!1}))}async function q(e,t){if(i.isGuest)o("Please login to comment");else if(!a.value){if(!e)return;await e.validate(async(n,d)=>{n?(a.value=!0,await u.ideas.comment(t.idea.id,{body:t.body,parent_id:t.parent_id??null}).then(v=>{l(v.data.idea),i.updateUserComments(v.data.user_comments)}).finally(()=>{a.value=!1})):console.log("error submit!",d)})}}function A(e){}function C(){return i.isGuest?(o("Please login to vote"),!1):!0}async function E(e,t){a.value=!0,await u.ideas.vote(e.id,{type:t}).then(n=>{l(n.data.idea),i.updateUserVotes(n.data.user_votes),o("Voted successfully")}).finally(()=>{a.value=!1})}return(e,t)=>{const n=Q,d=W,v=Y;return r(),P(x,null,[f(s(ee),{title:"My Ideas"}),f(ne,null,{default:_(()=>[f(n,{right:50,bottom:50}),f(v,null,{default:_(()=>[f(d,null,{default:_(()=>[f(J,{onShowModal:s(b)},null,8,["onShowModal"]),(r(!0),P(x,null,te(s(m),c=>(r(),y(X,{key:c.id,idea:c,submitting:a.value,onShowEditModalHandler:s(p),onShowCommentModalHandler:s(M),onDeleteIdeaHandler:O,onVoteUpHandler:j,onVoteDownHandler:L,onFavoriteIdeaHandler:T,onSendIdeaHandler:A},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler"]))),128)),ae("div",{ref_key:"landmark",ref:S},null,512)]),_:1})]),_:1}),s(N)?(r(),y(H,{key:0,"idea-form":s(g),submitting:a.value,title:"New Idea","submit-button-text":"Post",onClose:t[0]||(t[0]=c=>s(b)(!1)),onSubmit:k,onReset:s(h)},null,8,["idea-form","submitting","onReset"])):w("",!0),s(B)?(r(),y(H,{key:1,"idea-form":s(g),submitting:a.value,title:"Edit Idea","submit-button-text":"Save",onClose:t[1]||(t[1]=c=>s(p)(!1)),onSubmit:k,onReset:s(h)},null,8,["idea-form","submitting","onReset"])):w("",!0),s($)?(r(),y(K,{key:2,"idea-comment-form":s(F),submitting:a.value,"submit-button-text":"Post",onClose:t[2]||(t[2]=c=>s(M)(!1)),onSubmit:q},null,8,["idea-comment-form","submitting"])):w("",!0)]),_:1})],64)}}};export{ce as default};
