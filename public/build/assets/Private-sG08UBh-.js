import{p as c,q as b,s as w,o as r,f as i,b as t,m as k,l as C,i as T,x as $,y as M,t as h,g as U,z as F,_ as j,Z as A,k as f,c as B,w as _,a as y}from"./app-B131xkWy.js";import{a as x}from"./api-CGciP-Yd.js";import{A as D}from"./App-DFXRpRXq.js";import"./base-BxzQyodq.js";import"./el-main-HsEncQJt.js";import"./el-col-CbKf-FVE.js";import"./App.vue_vue_type_style_index_0_scoped_9c70e886_lang-BwM0L-I4.js";import"./el-popper-VBjhWgeT.js";import"./UserStore-BcJf6-Lv.js";import"./ApplicationLogo-DTJMVEkI.js";import"./error-Cq9Fpw4b.js";import"./index-DXKIKMyC.js";const E={class:"flex flex-col justify-end h-80"},H={key:0,class:"p-2 ml-auto text-white bg-blue-500 rounded-lg"},O={key:1,class:"p-2 mr-auto bg-gray-200 rounded-lg"},V={class:"flex items-center"},q={key:0,class:"text-gray-700"},K={__name:"ChatComponent",props:{friend:{type:Object,required:!0},currentUser:{type:Object,required:!0}},setup(d){const n=d,s=c([]),a=c(""),u=c(null),p=c(!1),l=c(null);b(s,()=>{F(()=>{u.value.scrollTo({top:u.value.scrollHeight,behavior:"smooth"})})},{deep:!0});const m=async()=>{if(a.value.trim()!=="")try{const e=await x.messages.sendMessage(n.friend.id,{message:a.value});s.value.push(e.data.message),a.value=""}catch(e){console.error("Failed to send message:",e)}},g=()=>{Echo.private(`chat.${n.friend.id}`).whisper("typing",{userID:n.currentUser.id})};return w(async()=>{try{const e=await x.messages.getMessages(n.friend.id);s.value=e.data}catch(e){console.error("Failed to load messages:",e)}Echo.private(`chat.${n.currentUser.id}`).listen("MessageSent",e=>{s.value.push(e.data.message)}).listenForWhisper("typing",e=>{p.value=e.userID===n.friend.id,l.value&&clearTimeout(l.value),l.value=setTimeout(()=>{p.value=!1},1e3)})}),(e,v)=>(r(),i("div",null,[t("div",E,[t("div",{ref_key:"messagesContainer",ref:u,class:"p-4 overflow-y-auto max-h-fit"},[(r(!0),i(k,null,C(s.value,o=>(r(),i("div",{key:o.id,class:"flex items-center mb-2"},[o.sender_id===d.currentUser.id?(r(),i("div",H,h(o.text),1)):(r(),i("div",O,h(o.text),1))]))),128))],512)]),t("div",V,[T(t("input",{type:"text","onUpdate:modelValue":v[0]||(v[0]=o=>a.value=o),onKeydown:g,onKeyup:M(m,["enter"]),placeholder:"Type a message...",class:"flex-1 px-2 py-1 border rounded-lg"},null,544),[[$,a.value]]),t("button",{onClick:m,class:"px-4 py-1 ml-2 text-white bg-blue-500 rounded-lg"}," Send ")]),p.value?(r(),i("small",q,h(d.friend.name)+" is typing... ",1)):U("",!0)]))}},N={components:{App:D,Head:A,ChatComponent:K},props:{friend:Object,currentUser:Object}},S={class:"text-xl font-semibold leading-tight text-gray-800"},I={class:"py-12"},P={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},z={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},L={class:"p-6 bg-white border-b border-gray-200"};function W(d,n,s,a,u,p){const l=f("Head"),m=f("chat-component"),g=f("App");return r(),B(g,null,{header:_(()=>[y(l,{title:"Private chat with "+s.friend.name},null,8,["title"])]),default:_(()=>[t("div",null,[t("h2",S,h(s.friend.name),1),t("div",I,[t("div",P,[t("div",z,[t("div",L,[y(m,{friend:s.friend,"current-user":s.currentUser},null,8,["friend","current-user"])])])])])])]),_:1})}const ae=j(N,[["render",W]]);export{ae as default};
