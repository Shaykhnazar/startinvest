/* empty css             */import{E as W,a as Z}from"./el-main-BiLF6z3s.js";import{u as J,a as K,P as Q,_ as V,I as X,b as ee,E as ae,c as ie}from"./IdeaDeleteModal-SiQZ8Kgc.js";import{m as x,o as m,f as U,a as l,u as i,w as _,F as q,Z as te,p as ne,b as oe,c as p,g}from"./app-TOhbaQ19.js";import{u as le,V as F}from"./UserStore-D4lAcemb.js";import{u as se}from"./helpers-CwC0Di9K.js";import{a as f}from"./api-Ck_UKqTo.js";import{_ as de}from"./CabinetLayout.vue_vue_type_script_setup_true_lang-BaszCNEq.js";import"./plugin-vue_export-helper-CUItRfFD.js";import"./index-CT-6bP4K.js";import"./use-global-config-CO3IU8QP.js";import"./el-col-Cyh3COcP.js";import"./el-popper-BsuHNmpL.js";import"./el-button-BV29s6GR.js";import"./TextEditor-ScDuyLeQ.js";/* empty css                   */import"./el-avatar-BTYSGwYi.js";import"./ApplicationLogo-CEuHbxig.js";const Ee={__name:"Index",props:{ideas:{type:Object}},setup(re){const I=x(null),{ideaForm:M,ideaCommentForm:G,ideaDeleteModalProps:z,resetForm:k,showIdeaModal:b,showIdeaEditModal:y,showIdeaCommentModal:S,showIdeaDeleteModal:h,ideaModalVisible:$,ideaEditModalVisible:P,ideaCommentModalVisible:B,ideaDeleteModalVisible:N}=J(),{info:s,success:w}=se(),{items:c}=K("ideas",I),o=le(),t=x(!1),d=(e,a=!1)=>{const n=c.value.findIndex(r=>r.id===e.id);n!==-1&&!a?c.value[n]=e:a?c.value.splice(n,1):c.value.unshift(e)},C=async(e,a)=>{e&&await e.validate((n,r)=>{n&&(t.value=!0,a.id!==null?O(a):R(a))})},O=async e=>{await f.ideas.edit(e.id,{title:e.title,description:e.description}).then(a=>{d(a.data.idea),y(!1),w("Fikr muvaffaqiyatli tahrirlandi")}).finally(()=>{t.value=!1})},R=async e=>{await f.ideas.add({title:e.title,description:e.description}).then(a=>{d(a.data.idea),b(!1),w("Fikr muvaffaqiyatli qo'shildi")}).finally(()=>{t.value=!1})},D=async e=>{t.value=!0,await f.ideas.delete(e).then(a=>{d(a.data.idea,!0),h(!1),s("Fikr muvaffaqiyatli oÊ»chirildi")}).finally(()=>{t.value=!1})};async function j(e){H()&&!o.hasUpvotedIdea(e)&&!t.value&&await E(e,F.UP)}async function L(e){H()&&!o.hasDownvotedIdea(e)&&!t.value&&await E(e,F.DOWN)}async function T(e){o.isGuest?s("G'oyalarni saqlash uchun tizimga kiring"):t.value||(t.value=!0,await f.ideas.favorite(e.id).then(a=>{d(a.data.idea),o.updateUserFavorites(a.data.user_favorites),o.hasFavoritedIdea(e)?w("G'oya muvaffaqiyatli saqlandi"):s("G'oya sizning sevimlilar ro'yxatingizdan o'chirildi")}).finally(()=>{t.value=!1}))}async function Y(e,a){if(o.isGuest)s("Iltimos, fikr bildirish uchun tizimga kiring");else if(!t.value){if(!e)return;await e.validate(async(n,r)=>{n?(t.value=!0,await f.ideas.comment(a.idea.id,{body:a.body,parent_id:a.parent_id??null}).then(v=>{d(v.data.idea),o.updateUserComments(v.data.user_comments)}).finally(()=>{t.value=!1})):console.log("error submit!",r)})}}function A(e){}function H(){return o.isGuest?(s("Ovoz berish uchun tizimga kiring"),!1):!0}async function E(e,a){t.value=!0,await f.ideas.vote(e.id,{type:a}).then(n=>{d(n.data.idea),o.updateUserVotes(n.data.user_votes),s("Muvaffaqiyatli ovoz berildi")}).finally(()=>{t.value=!1})}return(e,a)=>{const n=ae,r=W,v=Z;return m(),U(q,null,[l(i(te),{title:"G'oyalarim"}),l(de,null,{default:_(()=>[l(n,{right:50,bottom:50}),l(v,{class:"justify-center"},{default:_(()=>[l(r,{class:"max-w-[50rem]"},{default:_(()=>[l(Q,{onShowModal:i(b)},null,8,["onShowModal"]),(m(!0),U(q,null,ne(i(c),u=>(m(),p(ie,{key:u.id,idea:u,submitting:t.value,onShowEditModalHandler:i(y),onShowCommentModalHandler:i(S),onShowDeleteModalHandler:i(h),onVoteUpHandler:j,onVoteDownHandler:L,onFavoriteIdeaHandler:T,onSendIdeaHandler:A,class:"mb-2"},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler","onShowDeleteModalHandler"]))),128)),oe("div",{ref_key:"landmark",ref:I},null,512)]),_:1})]),_:1}),i($)?(m(),p(V,{key:0,"idea-form":i(M),submitting:t.value,title:"Yangi g'oya","submit-button-text":"Ulashish",onClose:a[0]||(a[0]=u=>i(b)(!1)),onSubmit:C,onReset:i(k)},null,8,["idea-form","submitting","onReset"])):g("",!0),i(P)?(m(),p(V,{key:1,"idea-form":i(M),submitting:t.value,title:"Go'yani tahrirlash","submit-button-text":"Saqlash",onClose:a[1]||(a[1]=u=>i(y)(!1)),onSubmit:C,onReset:i(k)},null,8,["idea-form","submitting","onReset"])):g("",!0),i(B)?(m(),p(X,{key:2,"idea-comment-form":i(G),submitting:t.value,"submit-button-text":"Ulashish",onClose:a[2]||(a[2]=u=>i(S)(!1)),onSubmit:Y},null,8,["idea-comment-form","submitting"])):g("",!0),l(ee,{"is-visible":i(N),idea:i(z).idea,onClose:a[3]||(a[3]=u=>i(h)(!1)),onDeleteIdeaHandler:D},null,8,["is-visible","idea"])]),_:1})],64)}}};export{Ee as default};
