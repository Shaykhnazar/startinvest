import{m as c,q as b,s as w,o as a,f as i,b as t,F as C,p as k,h as T,v as $,C as F,t as h,g as M,B as U,_ as j,Z as B,af as f,c as A,w as _,a as y}from"./app-CUnbgRqf.js";import{a as x}from"./api-QEF-lEob.js";import{A as D}from"./App-CmP6x9zu.js";import"./base-BSrQRjeB.js";import"./el-main-nA3g-Ve4.js";import"./UserStore-CB2ue7Uj.js";import"./ApplicationLogo-ByyaMjyt.js";const E={class:"flex flex-col justify-end h-80"},H={key:0,class:"p-2 ml-auto text-white bg-blue-500 rounded-lg"},O={key:1,class:"p-2 mr-auto bg-gray-200 rounded-lg"},V={class:"flex items-center"},q={key:0,class:"text-gray-700"},K={__name:"ChatComponent",props:{friend:{type:Object,required:!0},currentUser:{type:Object,required:!0}},setup(d){const n=d,s=c([]),r=c(""),u=c(null),p=c(!1),l=c(null);b(s,()=>{U(()=>{u.value.scrollTo({top:u.value.scrollHeight,behavior:"smooth"})})},{deep:!0});const m=async()=>{if(r.value.trim()!=="")try{const e=await x.messages.sendMessage(n.friend.id,{message:r.value});s.value.push(e.data.message),r.value=""}catch(e){console.error("Failed to send message:",e)}},g=()=>{Echo.private(`chat.${n.friend.id}`).whisper("typing",{userID:n.currentUser.id})};return w(async()=>{try{const e=await x.messages.getMessages(n.friend.id);s.value=e.data}catch(e){console.error("Failed to load messages:",e)}Echo.private(`chat.${n.currentUser.id}`).listen("MessageSent",e=>{console.log(e),s.value.push(e.data.message)}).listenForWhisper("typing",e=>{p.value=e.userID===n.friend.id,l.value&&clearTimeout(l.value),l.value=setTimeout(()=>{p.value=!1},1e3)})}),(e,v)=>(a(),i("div",null,[t("div",E,[t("div",{ref_key:"messagesContainer",ref:u,class:"p-4 overflow-y-auto max-h-fit"},[(a(!0),i(C,null,k(s.value,o=>(a(),i("div",{key:o.id,class:"flex items-center mb-2"},[o.sender_id===d.currentUser.id?(a(),i("div",H,h(o.text),1)):(a(),i("div",O,h(o.text),1))]))),128))],512)]),t("div",V,[T(t("input",{type:"text","onUpdate:modelValue":v[0]||(v[0]=o=>r.value=o),onKeydown:g,onKeyup:F(m,["enter"]),placeholder:"Type a message...",class:"flex-1 px-2 py-1 border rounded-lg"},null,544),[[$,r.value]]),t("button",{onClick:m,class:"px-4 py-1 ml-2 text-white bg-blue-500 rounded-lg"}," Send ")]),p.value?(a(),i("small",q,h(d.friend.name)+" is typing... ",1)):M("",!0)]))}},N={components:{App:D,Head:B,ChatComponent:K},props:{friend:Object,currentUser:Object}},S={class:"text-xl font-semibold leading-tight text-gray-800"},I={class:"py-12"},P={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},L={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},W={class:"p-6 bg-white border-b border-gray-200"};function Z(d,n,s,r,u,p){const l=f("Head"),m=f("chat-component"),g=f("App");return a(),A(g,null,{header:_(()=>[y(l,{title:"Private chat with "+s.friend.name},null,8,["title"])]),default:_(()=>[t("div",null,[t("h2",S,h(s.friend.name),1),t("div",I,[t("div",P,[t("div",L,[t("div",W,[y(m,{friend:s.friend,"current-user":s.currentUser},null,8,["friend","current-user"])])])])])])]),_:1})}const ee=j(N,[["render",Z]]);export{ee as default};
