import"./base-ccfe9847.js";import{E as A,a as J}from"./el-main-207f3a41.js";import{u as W,a as Y,P as Z,_ as H,I as q,b as u,E as z,c as K}from"./useInfiniteScroll-cbb591eb.js";import{_ as Q}from"./App-1f1f92cd.js";import{p as V,o as r,c,w as b,a as v,u as i,Z as X,f as D,J as ee,k as te,b as ae,g as w}from"./app-d86e0e0e.js";import{u as ie,V as P}from"./UserStore-c347140f.js";import{u as oe}from"./helpers-f5ef9704.js";import"./el-col-d4487678.js";import"./error-78e43d3e.js";import"./el-button-232ec27b.js";import"./index-c88db790.js";import"./el-input-399f3d7a.js";import"./el-popper-3d24ff8e.js";import"./el-divider-5a9fbb37.js";import"./el-popover-5afc716b.js";import"./useNavActiveTab-327b98b7.js";import"./index-2f19c7a3.js";const ge={__name:"Index",props:{ideas:{type:Object}},setup(se){const h=V(null),{ideaForm:S,ideaCommentForm:x,resetForm:g,showIdeaModal:y,showIdeaEditModal:I,showIdeaCommentModal:M,ideaModalVisible:U,ideaEditModalVisible:N,ideaCommentModalVisible:B}=W(),{info:n,success:_}=oe(),{items:m}=Y("ideas",h),s=ie(),a=V(!1),l=(e,t=!1)=>{const o=m.value.findIndex(d=>d.id===e.id);o!==-1&&!t?m.value[o]=e:t?m.value.splice(o,1):m.value.unshift(e)},k=async(e,t)=>{e&&await e.validate((o,d)=>{o&&(a.value=!0,t.id!==null?F(t):$(t))})},F=async e=>{await u.ideas.edit(e.id,{title:e.title,description:e.description}).then(t=>{l(t.data.idea),I(!1),_("Idea edited successfully")}).finally(()=>{a.value=!1})},$=async e=>{await u.ideas.add({title:e.title,description:e.description}).then(t=>{l(t.data.idea),y(!1),_("Idea added successfully")}).finally(()=>{a.value=!1})},R=async e=>{a.value=!0,await u.ideas.delete(e).then(t=>{l(t.data.idea,!0),n("Idea deleted successfully")}).finally(()=>{a.value=!1})};async function G(e){C()&&!s.hasUpvotedIdea(e)&&!a.value&&await E(e,P.UP)}async function O(e){C()&&!s.hasDownvotedIdea(e)&&!a.value&&await E(e,P.DOWN)}async function L(e){s.isGuest?n("Please login to save ideas"):a.value||(a.value=!0,await u.ideas.favorite(e.id).then(t=>{l(t.data.idea),s.updateUserFavorites(t.data.user_favorites),s.hasFavoritedIdea(e)?_("Idea saved successfully"):n("Idea removed from your favorites")}).finally(()=>{a.value=!1}))}async function T(e,t){if(s.isGuest)n("Please login to comment");else if(!a.value){if(!e)return;await e.validate(async(o,d)=>{o?(a.value=!0,await u.ideas.comment(t.idea.id,{body:t.body,parent_id:t.parent_id??null}).then(p=>{l(p.data.idea),s.updateUserComments(p.data.user_comments)}).finally(()=>{a.value=!1})):console.log("error submit!",d)})}}function j(e){}function C(){return s.isGuest?(n("Please login to vote"),!1):!0}async function E(e,t){a.value=!0,await u.ideas.vote(e.id,{type:t}).then(o=>{l(o.data.idea),s.updateUserVotes(o.data.user_votes),n("Voted successfully")}).finally(()=>{a.value=!1})}return(e,t)=>{const o=z,d=A,p=J;return r(),c(Q,null,{header:b(()=>[v(i(X),{title:"Ideas"})]),default:b(()=>[v(o,{right:50,bottom:50}),v(p,null,{default:b(()=>[v(d,null,{default:b(()=>[v(Z,{onShowModal:i(y)},null,8,["onShowModal"]),(r(!0),D(te,null,ee(i(m),f=>(r(),c(K,{key:f.id,idea:f,submitting:a.value,onShowEditModalHandler:i(I),onShowCommentModalHandler:i(M),onDeleteIdeaHandler:R,onVoteUpHandler:G,onVoteDownHandler:O,onFavoriteIdeaHandler:L,onSendIdeaHandler:j},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler"]))),128)),ae("div",{ref_key:"landmark",ref:h},null,512)]),_:1})]),_:1}),i(U)?(r(),c(H,{key:0,"idea-form":i(S),submitting:a.value,title:"New Idea","submit-button-text":"Post",onClose:t[0]||(t[0]=f=>i(y)(!1)),onSubmit:k,onReset:i(g)},null,8,["idea-form","submitting","onReset"])):w("",!0),i(N)?(r(),c(H,{key:1,"idea-form":i(S),submitting:a.value,title:"Edit Idea","submit-button-text":"Save",onClose:t[1]||(t[1]=f=>i(I)(!1)),onSubmit:k,onReset:i(g)},null,8,["idea-form","submitting","onReset"])):w("",!0),i(B)?(r(),c(q,{key:2,"idea-comment-form":i(x),submitting:a.value,"submit-button-text":"Post",onClose:t[2]||(t[2]=f=>i(M)(!1)),onSubmit:T},null,8,["idea-comment-form","submitting"])):w("",!0)]),_:1})}}};export{ge as default};
