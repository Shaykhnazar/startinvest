/* empty css             */import{E as j,a as A}from"./el-main-B7V3latj.js";import{u as W,a as Z,P as J,_ as H,I as K,E as Q,b as X}from"./useInfiniteScroll-Dukb50Wc.js";import{m as F,o as d,f as V,a as u,u as i,w as _,F as U,Z as D,p as ee,b as ae,c as p,g as w}from"./app-BVEWpKNB.js";import{u as te,V as q}from"./UserStore-B5SiQ4Uz.js";import{u as ie}from"./helpers--8ZkwWuN.js";import{a as m}from"./api-CkdGCLvF.js";import{_ as ne}from"./CabinetLayout.vue_vue_type_script_setup_true_lang-BPQFVwAf.js";import"./plugin-vue_export-helper-CO5Aj5ce.js";import"./index-BH76j2uT.js";import"./use-global-config-Bv912UFb.js";import"./event-Ccp5Doe-.js";import"./el-popper-Boyvy_Wh.js";import"./el-button-B_ZlppaL.js";import"./TextEditor-BTnlsons.js";/* empty css                   */import"./el-col-HMeSGw8N.js";import"./el-avatar-BGPopQ45.js";import"./ApplicationLogo-LD5TGzw3.js";const Me={__name:"Index",props:{ideas:{type:Object}},setup(oe){const g=F(null),{ideaForm:k,ideaCommentForm:x,resetForm:I,showIdeaModal:b,showIdeaEditModal:h,showIdeaCommentModal:S,ideaModalVisible:z,ideaEditModalVisible:B,ideaCommentModalVisible:G}=W(),{info:l,success:y}=ie(),{items:f}=Z("ideas",g),o=te(),t=F(!1),s=(e,a=!1)=>{const n=f.value.findIndex(r=>r.id===e.id);n!==-1&&!a?f.value[n]=e:a?f.value.splice(n,1):f.value.unshift(e)},M=async(e,a)=>{e&&await e.validate((n,r)=>{n&&(t.value=!0,a.id!==null?N(a):P(a))})},N=async e=>{await m.ideas.edit(e.id,{title:e.title,description:e.description}).then(a=>{s(a.data.idea),h(!1),y("Fikr muvaffaqiyatli tahrirlandi")}).finally(()=>{t.value=!1})},P=async e=>{await m.ideas.add({title:e.title,description:e.description}).then(a=>{s(a.data.idea),b(!1),y("Fikr muvaffaqiyatli qo'shildi")}).finally(()=>{t.value=!1})},$=async e=>{t.value=!0,await m.ideas.delete(e).then(a=>{s(a.data.idea,!0),l("Fikr muvaffaqiyatli oÊ»chirildi")}).finally(()=>{t.value=!1})};async function O(e){C()&&!o.hasUpvotedIdea(e)&&!t.value&&await E(e,q.UP)}async function R(e){C()&&!o.hasDownvotedIdea(e)&&!t.value&&await E(e,q.DOWN)}async function L(e){o.isGuest?l("Iltimos, fikrlarni saqlash uchun tizimga kiring"):t.value||(t.value=!0,await m.ideas.favorite(e.id).then(a=>{s(a.data.idea),o.updateUserFavorites(a.data.user_favorites),o.hasFavoritedIdea(e)?y("Fikr muvaffaqiyatli saqlandi"):l("Fikr sevimlilaringizdan olib tashlandi")}).finally(()=>{t.value=!1}))}async function T(e,a){if(o.isGuest)l("Iltimos, fikr bildirish uchun tizimga kiring");else if(!t.value){if(!e)return;await e.validate(async(n,r)=>{n?(t.value=!0,await m.ideas.comment(a.idea.id,{body:a.body,parent_id:a.parent_id??null}).then(v=>{s(v.data.idea),o.updateUserComments(v.data.user_comments)}).finally(()=>{t.value=!1})):console.log("error submit!",r)})}}function Y(e){}function C(){return o.isGuest?(l("Ovoz berish uchun tizimga kiring"),!1):!0}async function E(e,a){t.value=!0,await m.ideas.vote(e.id,{type:a}).then(n=>{s(n.data.idea),o.updateUserVotes(n.data.user_votes),l("Muvaffaqiyatli ovoz berildi")}).finally(()=>{t.value=!1})}return(e,a)=>{const n=Q,r=j,v=A;return d(),V(U,null,[u(i(D),{title:"G'oyalarim"}),u(ne,null,{default:_(()=>[u(n,{right:50,bottom:50}),u(v,null,{default:_(()=>[u(r,null,{default:_(()=>[u(J,{onShowModal:i(b)},null,8,["onShowModal"]),(d(!0),V(U,null,ee(i(f),c=>(d(),p(X,{key:c.id,idea:c,submitting:t.value,onShowEditModalHandler:i(h),onShowCommentModalHandler:i(S),onDeleteIdeaHandler:$,onVoteUpHandler:O,onVoteDownHandler:R,onFavoriteIdeaHandler:L,onSendIdeaHandler:Y,class:"mb-2"},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler"]))),128)),ae("div",{ref_key:"landmark",ref:g},null,512)]),_:1})]),_:1}),i(z)?(d(),p(H,{key:0,"idea-form":i(k),submitting:t.value,title:"Yangi g'oya","submit-button-text":"Ulashish",onClose:a[0]||(a[0]=c=>i(b)(!1)),onSubmit:M,onReset:i(I)},null,8,["idea-form","submitting","onReset"])):w("",!0),i(B)?(d(),p(H,{key:1,"idea-form":i(k),submitting:t.value,title:"Go'yani tahrirlash","submit-button-text":"Saqlash",onClose:a[1]||(a[1]=c=>i(h)(!1)),onSubmit:M,onReset:i(I)},null,8,["idea-form","submitting","onReset"])):w("",!0),i(G)?(d(),p(K,{key:2,"idea-comment-form":i(x),submitting:t.value,"submit-button-text":"Ulashish",onClose:a[2]||(a[2]=c=>i(S)(!1)),onSubmit:T},null,8,["idea-comment-form","submitting"])):w("",!0)]),_:1})],64)}}};export{Me as default};
