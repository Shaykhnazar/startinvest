/* empty css             */import{a as Y,E as Z}from"./el-main-DaZawinT.js";import{u as J,a as K,P as Q,I as X,b as E,c as ee,_ as te,E as ae}from"./IdeaDeleteModal-nJZxfNbW.js";import{p as V,o as s,f as G,a as m,u as a,w as I,F as U,Z as ie,m as ne,c as b,b as oe,g as v}from"./app-CnNuEMmT.js";import{u as se,V as q}from"./UserStore-CylqSXgE.js";import{u as le}from"./helpers-Dg_TcOmu.js";import{a as f}from"./api-DSHBDJK5.js";import{_ as de}from"./CabinetLayout.vue_vue_type_script_setup_true_lang-DnN-tuSD.js";import"./plugin-vue_export-helper-M7vFY8lq.js";import"./index-DIlMAJ2O.js";import"./use-global-config-BsByRpBn.js";import"./event-COqp9pWW.js";import"./el-popper-CuE4q0dM.js";import"./el-button--wi5tl2p.js";import"./BaseFormTextInput-CHEt0fwN.js";import"./el-input-IJWobApS.js";import"./_initCloneObject-DdJ4LLpi.js";import"./marked.esm-Cv8YM6Xl.js";import"./Popover-CH0fTm9t.js";/* empty css                   */import"./ApplicationLogo-zwZo2Nlb.js";const Ge={__name:"Index",props:{ideas:{type:Object}},setup(re){const g=V(null),{ideaForm:M,ideaCommentForm:x,ideaDeleteModalProps:z,resetForm:S,showIdeaModal:y,showIdeaEditModal:w,showIdeaCommentModal:k,showIdeaDeleteModal:h,ideaModalVisible:F,ideaEditModalVisible:P,ideaCommentModalVisible:B,ideaDeleteModalVisible:N}=J(),{info:l,success:_}=le(),{items:c}=K("ideas",g),o=se(),i=V(!1),d=(e,t=!1)=>{const n=c.findIndex(r=>r.id===e.id);n!==-1&&!t?c[n]=e:t?c.splice(n,1):c.unshift(e)},$=async(e,t)=>{e&&await e.validate((n,r)=>{n&&(i.value=!0,t.id!==null?O(t):R(t))})},O=async e=>{await f.ideas.edit(e.id,{title:e.title,description:e.description}).then(t=>{d(t.data.idea),w(!1),_("G'oya muvaffaqiyatli tahrirlandi")}).finally(()=>{i.value=!1})},R=async e=>{await f.ideas.add({title:e.title,description:e.description}).then(t=>{d(t.data.idea),y(!1),_("G'oya muvaffaqiyatli qo'shildi")}).finally(()=>{i.value=!1})},D=async e=>{i.value=!0,await f.ideas.delete(e).then(t=>{d(t.data.idea,!0),h(!1),l("G'oya muvaffaqiyatli o'chirildi")}).finally(()=>{i.value=!1})};async function j(e){C()&&!o.hasUpvotedIdea(e)&&!i.value&&await H(e,q.UP)}async function L(e){C()&&!o.hasDownvotedIdea(e)&&!i.value&&await H(e,q.DOWN)}async function T(e){o.isGuest?l("G'oyalarni saqlash uchun tizimga kiring"):i.value||(i.value=!0,await f.ideas.favorite(e.id).then(t=>{d(t.data.idea),o.updateUserFavorites(t.data.user_favorites),o.hasFavoritedIdea(e)?_("G'oya muvaffaqiyatli saqlandi"):l("G'oya sizning sevimlilar ro'yxatingizdan o'chirildi")}).finally(()=>{i.value=!1}))}async function A(e,t){if(o.isGuest)l("Iltimos, fikr bildirish uchun tizimga kiring");else if(!i.value){if(!e)return;await e.validate(async(n,r)=>{n?(i.value=!0,await f.ideas.comment(t.idea.id,{body:t.body,parent_id:t.parent_id??null}).then(p=>{d(p.data.idea),o.updateUserComments(p.data.user_comments)}).finally(()=>{i.value=!1})):console.log("error submit!",r)})}}function W(e){}function C(){return o.isGuest?(l("Ovoz berish uchun tizimga kiring"),!1):!0}async function H(e,t){i.value=!0,await f.ideas.vote(e.id,{type:t}).then(n=>{d(n.data.idea),o.updateUserVotes(n.data.user_votes),l("Ovoz berildi")}).finally(()=>{i.value=!1})}return(e,t)=>{const n=ae,r=Y,p=Z;return s(),G(U,null,[m(a(ie),{title:e.$t("cabinet.ideas.title")},null,8,["title"]),m(de,null,{default:I(()=>[m(n,{right:50,bottom:50}),m(p,{class:"justify-center"},{default:I(()=>[m(r,{class:"max-w-[50rem]"},{default:I(()=>[m(Q,{onShowModal:a(y),title:e.$t("cabinet.ideas.new_idea")},null,8,["onShowModal","title"]),(s(!0),G(U,null,ne(a(c),u=>(s(),b(X,{key:u.id,idea:u,submitting:i.value,onShowEditModalHandler:a(w),onShowCommentModalHandler:a(k),onShowDeleteModalHandler:a(h),onVoteUpHandler:j,onVoteDownHandler:L,onFavoriteIdeaHandler:T,onSendIdeaHandler:W,class:"mb-2"},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler","onShowDeleteModalHandler"]))),128)),oe("div",{ref_key:"landmark",ref:g},null,512)]),_:1})]),_:1}),a(F)?(s(),b(E,{key:0,"idea-form":a(M),submitting:i.value,title:e.$t("cabinet.ideas.new_idea"),"submit-button-text":e.$t("cabinet.ideas.submit_button_share"),onClose:t[0]||(t[0]=u=>a(y)(!1)),onSubmit:$,onReset:a(S)},null,8,["idea-form","submitting","title","submit-button-text","onReset"])):v("",!0),a(P)?(s(),b(E,{key:1,"idea-form":a(M),submitting:i.value,title:e.$t("cabinet.ideas.edit_idea"),"submit-button-text":e.$t("cabinet.ideas.submit_button_save"),onClose:t[1]||(t[1]=u=>a(w)(!1)),onSubmit:$,onReset:a(S)},null,8,["idea-form","submitting","title","submit-button-text","onReset"])):v("",!0),a(B)?(s(),b(ee,{key:2,"idea-comment-form":a(x),submitting:i.value,"submit-button-text":e.$t("cabinet.ideas.submit_button_share"),onClose:t[2]||(t[2]=u=>a(k)(!1)),onSubmit:A},null,8,["idea-comment-form","submitting","submit-button-text"])):v("",!0),a(N)?(s(),b(te,{key:3,idea:a(z).idea,title:e.$t("cabinet.ideas.delete_idea"),"submit-button-text":e.$t("cabinet.ideas.submit_button_delete"),onClose:t[3]||(t[3]=u=>a(h)(!1)),onDeleteIdeaHandler:D},null,8,["idea","title","submit-button-text"])):v("",!0)]),_:1})],64)}}};export{Ge as default};
