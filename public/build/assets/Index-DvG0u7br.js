/* empty css             */import{b as Z,a as z,E as J}from"./el-main-CjtUXdeM.js";import{u as K,a as Q,P as X,_ as $,I as ee,b as te,E as ae,c as ie}from"./IdeaDeleteModal-xX_mb0mX.js";import{A as se}from"./App-Bw6PZTld.js";import{q as x,o as d,c as f,w as p,a as l,u as a,Z as oe,f as ne,p as de,F as le,b as ue,g as w,av as n}from"./app-DcDpBf15.js";import{u as re,V as U}from"./UserStore-CLQAMfCu.js";import{a as me}from"./helpers-BXnC-Y-s.js";import{a as b}from"./api-DqwARZvE.js";import"./plugin-vue_export-helper-oeDH0GKb.js";import"./index-BpRBM3HP.js";import"./event-DD1eTG4o.js";import"./el-popper-BSC9NWRD.js";import"./el-button-CG7VCxiZ.js";import"./el-input-B6v1MA8c.js";import"./Popover-CKQuHU1L.js";/* empty css                   */import"./ApplicationLogo-DEH7UTye.js";const $e={__name:"Index",props:{ideas:{type:Object}},setup(ce){const S=x(null),{ideaForm:g,ideaCommentForm:F,ideaDeleteModalProps:P,resetForm:k,showIdeaModal:y,showIdeaEditModal:h,showIdeaCommentModal:C,showIdeaDeleteModal:I,ideaModalVisible:B,ideaEditModalVisible:N,ideaCommentModalVisible:A,ideaDeleteModalVisible:R}=K(),{info:u,success:M}=me(),{items:_}=Q("ideas",S),o=re(),i=x(!1),r=(e,t=!1)=>{const s=_.findIndex(m=>m.id===e.id);s!==-1&&!t?_[s]=e:t?_.splice(s,1):_.unshift(e)},H=async(e,t)=>{e&&await e.validate((s,m)=>{s&&(i.value=!0,t.id!==null?D(t):G(t))})},D=async e=>{await b.ideas.edit(e.id,{title:e.title,description:e.description}).then(t=>{r(t.data.idea),h(!1),M(n("site.idea.actions.idea_edited_success"))}).finally(()=>{i.value=!1})},G=async e=>{await b.ideas.add({title:e.title,description:e.description}).then(t=>{r(t.data.idea),y(!1),M(n("site.idea.actions.idea_added_success"))}).finally(()=>{i.value=!1})},O=async e=>{i.value=!0,await b.ideas.delete(e).then(t=>{r(t.data.idea,!0),I(!1),u(n("site.idea.actions.idea_deleted_success"))}).finally(()=>{i.value=!1})};async function T(e){E()&&!o.hasUpvotedIdea(e)&&!i.value&&await V(e,U.UP)}async function j(e){E()&&!o.hasDownvotedIdea(e)&&!i.value&&await V(e,U.DOWN)}async function L(e){o.isGuest?u(n("site.idea.actions.login_to_save_idea")):i.value||(i.value=!0,await b.ideas.favorite(e.id).then(t=>{r(t.data.idea),o.updateUserFavorites(t.data.user_favorites),o.hasFavoritedIdea(e)?M(n("site.idea.actions.idea_saved_success")):u(n("site.idea.actions.idea_unsaved"))}).finally(()=>{i.value=!1}))}async function q(e,t){if(o.isGuest)u(n("site.idea.actions.login_to_comment"));else if(!i.value){if(!e)return;await e.validate(async(s,m)=>{s&&(i.value=!0,await b.ideas.comment(t.idea.id,{body:t.body,parent_id:t.parent_id??null}).then(v=>{r(v.data.idea),o.updateUserComments(v.data.user_comments)}).finally(()=>{i.value=!1}))})}}function W(e){}function E(){return o.isGuest?(u(n("site.idea.actions.login_to_vote")),!1):!0}async function V(e,t){i.value=!0,await b.ideas.vote(e.id,{type:t}).then(s=>{r(s.data.idea),o.updateUserVotes(s.data.user_votes),u(n("site.idea.actions.idea_vote_success"))}).finally(()=>{i.value=!1})}return(e,t)=>{const s=ae,m=Z,v=z,Y=J;return d(),f(se,null,{header:p(()=>[l(a(oe),{title:e.$t("site.idea.title")},null,8,["title"])]),default:p(()=>[l(s,{right:50,bottom:50,"visibility-height":300}),l(Y,{class:"justify-center"},{default:p(()=>[l(m,{class:"hidden md:block"}),l(v,{class:"max-w-[50rem]"},{default:p(()=>[l(X,{onShowModal:a(y)},null,8,["onShowModal"]),(d(!0),ne(le,null,de(a(_),c=>(d(),f(ie,{key:c.id,idea:c,submitting:i.value,onShowEditModalHandler:a(h),onShowCommentModalHandler:a(C),onShowDeleteModalHandler:a(I),onVoteUpHandler:T,onVoteDownHandler:j,onFavoriteIdeaHandler:L,onSendIdeaHandler:W,class:"mb-2"},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler","onShowDeleteModalHandler"]))),128)),ue("div",{ref_key:"landmark",ref:S},null,512)]),_:1}),l(m,{class:"hidden lg:block"})]),_:1}),a(B)?(d(),f($,{key:0,"idea-form":a(g),submitting:i.value,title:e.$t("site.idea.modals.new_idea_title"),"submit-button-text":e.$t("site.idea.modals.submit_share_button"),onClose:t[0]||(t[0]=c=>a(y)(!1)),onSubmit:H,onReset:a(k)},null,8,["idea-form","submitting","title","submit-button-text","onReset"])):w("",!0),a(N)?(d(),f($,{key:1,"idea-form":a(g),submitting:i.value,"submit-button-text":e.$t("site.idea.modals.submit_save_button"),onClose:t[1]||(t[1]=c=>a(h)(!1)),onSubmit:H,onReset:a(k)},null,8,["idea-form","submitting","submit-button-text","onReset"])):w("",!0),a(A)?(d(),f(ee,{key:2,"idea-comment-form":a(F),submitting:i.value,"submit-button-text":e.$t("site.idea.modals.submit_share_button"),onClose:t[2]||(t[2]=c=>a(C)(!1)),onSubmit:q},null,8,["idea-comment-form","submitting","submit-button-text"])):w("",!0),a(R)?(d(),f(te,{key:3,idea:a(P).idea,onClose:t[3]||(t[3]=c=>a(I)(!1)),onDeleteIdeaHandler:O},null,8,["idea"])):w("",!0)]),_:1})}}};export{$e as default};
