import{j as q,k as A}from"./useNavActiveTab-919294e8.js";import{u as W,a as Y,P as Z,_ as H,I as z,b as u,E as J,c as K,d as Q}from"./useInfiniteScroll-73e41803.js";import{_ as X}from"./App-a5f41739.js";import{q as V,o as r,c,w as y,a as v,u as s,Z as D,f as ee,I as ae,F as te,b as se,g as w}from"./app-2315477b.js";import{u as ne,V as P}from"./UserStore-0603bc16.js";import"./el-icon-0467a0db.js";const me={__name:"Index",props:{ideas:{type:Object}},setup(ie){const h=V(null),{ideaForm:S,ideaCommentForm:x,resetForm:g,showIdeaModal:p,showIdeaEditModal:I,showIdeaCommentModal:M,ideaModalVisible:U,ideaEditModalVisible:F,ideaCommentModalVisible:N}=W(),{info:o,success:_}=Q(),{items:f}=Y("ideas",h),i=ne(),t=V(!1),l=(e,a=!1)=>{const n=f.value.findIndex(d=>d.id===e.id);n!==-1&&!a?f.value[n]=e:a?f.value.splice(n,1):f.value.unshift(e)},k=async(e,a)=>{e&&await e.validate((n,d)=>{n&&(t.value=!0,a.id!==null?B(a):$(a))})},B=async e=>{await u.ideas.edit(e.id,{title:e.title,description:e.description}).then(a=>{l(a.data.idea),I(!1),_("Idea edited successfully")}).finally(()=>{t.value=!1})},$=async e=>{await u.ideas.add({title:e.title,description:e.description}).then(a=>{l(a.data.idea),p(!1),_("Idea added successfully")}).finally(()=>{t.value=!1})},R=async e=>{t.value=!0,await u.ideas.delete(e).then(a=>{l(a.data.idea,!0),o("Idea deleted successfully")}).finally(()=>{t.value=!1})};async function G(e){C()&&!i.hasUpvotedIdea(e)&&!t.value&&await E(e,P.UP)}async function O(e){C()&&!i.hasDownvotedIdea(e)&&!t.value&&await E(e,P.DOWN)}async function j(e){i.isGuest?o("Please login to save ideas"):t.value||(t.value=!0,await u.ideas.favorite(e.id).then(a=>{l(a.data.idea),i.updateUserFavorites(a.data.user_favorites),i.hasFavoritedIdea(e)?_("Idea saved successfully"):o("Idea removed from your favorites")}).finally(()=>{t.value=!1}))}async function L(e,a){if(i.isGuest)o("Please login to comment");else if(!t.value){if(!e)return;await e.validate(async(n,d)=>{n?(t.value=!0,await u.ideas.comment(a.idea.id,{body:a.body,parent_id:a.parent_id??null}).then(b=>{l(b.data.idea),i.updateUserComments(b.data.user_comments)}).finally(()=>{t.value=!1})):console.log("error submit!",d)})}}function T(e){}function C(){return i.isGuest?(o("Please login to vote"),!1):!0}async function E(e,a){t.value=!0,await u.ideas.vote(e.id,{type:a}).then(n=>{l(n.data.idea),i.updateUserVotes(n.data.user_votes),o("Voted successfully")}).finally(()=>{t.value=!1})}return(e,a)=>{const n=J,d=q,b=A;return r(),c(X,null,{header:y(()=>[v(s(D),{title:"Ideas"})]),default:y(()=>[v(n,{right:50,bottom:50}),v(b,null,{default:y(()=>[v(d,null,{default:y(()=>[v(Z,{onShowModal:s(p)},null,8,["onShowModal"]),(r(!0),ee(te,null,ae(s(f),m=>(r(),c(K,{key:m.id,idea:m,submitting:t.value,onShowEditModalHandler:s(I),onShowCommentModalHandler:s(M),onDeleteIdeaHandler:R,onVoteUpHandler:G,onVoteDownHandler:O,onFavoriteIdeaHandler:j,onSendIdeaHandler:T},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler"]))),128)),se("div",{ref_key:"landmark",ref:h},null,512)]),_:1})]),_:1}),s(U)?(r(),c(H,{key:0,"idea-form":s(S),submitting:t.value,title:"New Idea","submit-button-text":"Post",onClose:a[0]||(a[0]=m=>s(p)(!1)),onSubmit:k,onReset:s(g)},null,8,["idea-form","submitting","onReset"])):w("",!0),s(F)?(r(),c(H,{key:1,"idea-form":s(S),submitting:t.value,title:"Edit Idea","submit-button-text":"Save",onClose:a[1]||(a[1]=m=>s(I)(!1)),onSubmit:k,onReset:s(g)},null,8,["idea-form","submitting","onReset"])):w("",!0),s(N)?(r(),c(z,{key:2,"idea-comment-form":s(x),submitting:t.value,"submit-button-text":"Post",onClose:a[2]||(a[2]=m=>s(M)(!1)),onSubmit:L},null,8,["idea-comment-form","submitting"])):w("",!0)]),_:1})}}};export{me as default};
