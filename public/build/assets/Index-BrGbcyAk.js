import"./base-DwylrOFb.js";import{E as j,a as A}from"./el-main-Dp3B6DqS.js";import{E as W}from"./el-backtop-DO3pPJ2V.js";import{m as H,o as d,f as F,a as u,u as i,w as _,F as V,Z,p as J,b as K,c as p,g as w}from"./app-CrqW8ZGz.js";import{u as Q,a as X,P as D,_ as U,I as ee,b as ae}from"./useInfiniteScroll-BkUfqwpU.js";import{u as te,V as q}from"./UserStore-D0MyF4a0.js";import{u as ie}from"./helpers-DBZdwOgC.js";import{a as m}from"./api-DfQrOQmh.js";import{_ as ne}from"./CabinetLayout.vue_vue_type_script_setup_true_lang-Cf4EFjZw.js";import"./index-Cyu1h61p.js";import"./use-global-config-Dqta889X.js";import"./error-Cq9Fpw4b.js";import"./el-col-CLVjv5z6.js";import"./el-input-DTiC8SNL.js";import"./el-popper-OgXgVU5p.js";import"./el-divider-t7ZTMIeN.js";import"./el-tooltip-DKSxXQC4.js";import"./ApplicationLogo-yOEPHlZ_.js";const Se={__name:"Index",props:{ideas:{type:Object}},setup(oe){const g=H(null),{ideaForm:k,ideaCommentForm:x,resetForm:I,showIdeaModal:b,showIdeaEditModal:h,showIdeaCommentModal:S,ideaModalVisible:z,ideaEditModalVisible:B,ideaCommentModalVisible:G}=Q(),{info:l,success:y}=ie(),{items:f}=X("ideas",g),o=te(),t=H(!1),s=(e,a=!1)=>{const n=f.value.findIndex(r=>r.id===e.id);n!==-1&&!a?f.value[n]=e:a?f.value.splice(n,1):f.value.unshift(e)},M=async(e,a)=>{e&&await e.validate((n,r)=>{n&&(t.value=!0,a.id!==null?N(a):P(a))})},N=async e=>{await m.ideas.edit(e.id,{title:e.title,description:e.description}).then(a=>{s(a.data.idea),h(!1),y("Fikr muvaffaqiyatli tahrirlandi")}).finally(()=>{t.value=!1})},P=async e=>{await m.ideas.add({title:e.title,description:e.description}).then(a=>{s(a.data.idea),b(!1),y("Fikr muvaffaqiyatli qo'shildi")}).finally(()=>{t.value=!1})},$=async e=>{t.value=!0,await m.ideas.delete(e).then(a=>{s(a.data.idea,!0),l("Fikr muvaffaqiyatli oÊ»chirildi")}).finally(()=>{t.value=!1})};async function O(e){C()&&!o.hasUpvotedIdea(e)&&!t.value&&await E(e,q.UP)}async function R(e){C()&&!o.hasDownvotedIdea(e)&&!t.value&&await E(e,q.DOWN)}async function L(e){o.isGuest?l("Iltimos, fikrlarni saqlash uchun tizimga kiring"):t.value||(t.value=!0,await m.ideas.favorite(e.id).then(a=>{s(a.data.idea),o.updateUserFavorites(a.data.user_favorites),o.hasFavoritedIdea(e)?y("Fikr muvaffaqiyatli saqlandi"):l("Fikr sevimlilaringizdan olib tashlandi")}).finally(()=>{t.value=!1}))}async function T(e,a){if(o.isGuest)l("Iltimos, fikr bildirish uchun tizimga kiring");else if(!t.value){if(!e)return;await e.validate(async(n,r)=>{n?(t.value=!0,await m.ideas.comment(a.idea.id,{body:a.body,parent_id:a.parent_id??null}).then(v=>{s(v.data.idea),o.updateUserComments(v.data.user_comments)}).finally(()=>{t.value=!1})):console.log("error submit!",r)})}}function Y(e){}function C(){return o.isGuest?(l("Ovoz berish uchun tizimga kiring"),!1):!0}async function E(e,a){t.value=!0,await m.ideas.vote(e.id,{type:a}).then(n=>{s(n.data.idea),o.updateUserVotes(n.data.user_votes),l("Muvaffaqiyatli ovoz berildi")}).finally(()=>{t.value=!1})}return(e,a)=>{const n=W,r=j,v=A;return d(),F(V,null,[u(i(Z),{title:"G'oyalarim"}),u(ne,null,{default:_(()=>[u(n,{right:50,bottom:50}),u(v,null,{default:_(()=>[u(r,null,{default:_(()=>[u(D,{onShowModal:i(b)},null,8,["onShowModal"]),(d(!0),F(V,null,J(i(f),c=>(d(),p(ae,{key:c.id,idea:c,submitting:t.value,onShowEditModalHandler:i(h),onShowCommentModalHandler:i(S),onDeleteIdeaHandler:$,onVoteUpHandler:O,onVoteDownHandler:R,onFavoriteIdeaHandler:L,onSendIdeaHandler:Y},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler"]))),128)),K("div",{ref_key:"landmark",ref:g},null,512)]),_:1})]),_:1}),i(z)?(d(),p(U,{key:0,"idea-form":i(k),submitting:t.value,title:"Yangi g'oya","submit-button-text":"Ulashish",onClose:a[0]||(a[0]=c=>i(b)(!1)),onSubmit:M,onReset:i(I)},null,8,["idea-form","submitting","onReset"])):w("",!0),i(B)?(d(),p(U,{key:1,"idea-form":i(k),submitting:t.value,title:"Go'yani tahrirlash","submit-button-text":"Saqlash",onClose:a[1]||(a[1]=c=>i(h)(!1)),onSubmit:M,onReset:i(I)},null,8,["idea-form","submitting","onReset"])):w("",!0),i(G)?(d(),p(ee,{key:2,"idea-comment-form":i(x),submitting:t.value,"submit-button-text":"Ulashish",onClose:a[2]||(a[2]=c=>i(S)(!1)),onSubmit:T},null,8,["idea-comment-form","submitting"])):w("",!0)]),_:1})],64)}}};export{Se as default};
