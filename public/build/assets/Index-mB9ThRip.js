import"./base-BOIpQ8Gr.js";import{E as A,a as L}from"./el-main-C-oBClQj.js";import{u as T,a as j,P as W,_ as H,I as Z,E as J,b as K}from"./useInfiniteScroll-kuqRMX8M.js";import{A as Q}from"./App-j2gmGuWZ.js";import{m as G,o as d,c,w as y,a as v,u as i,Z as X,f as D,p as ee,F as ae,b as te,g}from"./app-BJ7AMfwr.js";import{u as ie,V}from"./UserStore-B47wwGXQ.js";import{u as ne}from"./helpers-T9lcjfWw.js";import{a as r}from"./api-BCzzO_VA.js";import"./index-CQo7SU4K.js";import"./el-button-BXGRTdPG.js";import"./event-BKGGIr3l.js";import"./el-popper-Iu0sVo4U.js";import"./el-input-JnQRjeRi.js";import"./el-divider-CaK_-uqk.js";import"./el-col-DVEbknNY.js";import"./el-tooltip-BVcZe9N8.js";/* empty css                   */import"./Popover-B9e3NoW4.js";import"./ApplicationLogo-BCPW_oq7.js";const Me={__name:"Index",props:{ideas:{type:Object}},setup(oe){const _=G(null),{ideaForm:I,ideaCommentForm:x,resetForm:S,showIdeaModal:h,showIdeaEditModal:b,showIdeaCommentModal:k,ideaModalVisible:q,ideaEditModalVisible:U,ideaCommentModalVisible:z}=T(),{info:s,success:w}=ne(),{items:u}=j("ideas",_),o=ie(),t=G(!1),l=(e,a=!1)=>{const n=u.value.findIndex(m=>m.id===e.id);n!==-1&&!a?u.value[n]=e:a?u.value.splice(n,1):u.value.unshift(e)},M=async(e,a)=>{e&&await e.validate((n,m)=>{n&&(t.value=!0,a.id!==null?F(a):B(a))})},F=async e=>{await r.ideas.edit(e.id,{title:e.title,description:e.description}).then(a=>{l(a.data.idea),b(!1),w("G'oya muvaffaqiyatli tahrirlandi")}).finally(()=>{t.value=!1})},B=async e=>{await r.ideas.add({title:e.title,description:e.description}).then(a=>{l(a.data.idea),h(!1),w("G'oya muvaffaqiyatli qo'shildi")}).finally(()=>{t.value=!1})},N=async e=>{t.value=!0,await r.ideas.delete(e).then(a=>{l(a.data.idea,!0),s("G'oya muvaffaqiyatli o'chirildi")}).finally(()=>{t.value=!1})};async function O(e){C()&&!o.hasUpvotedIdea(e)&&!t.value&&await E(e,V.UP)}async function P(e){C()&&!o.hasDownvotedIdea(e)&&!t.value&&await E(e,V.DOWN)}async function R(e){o.isGuest?s("G'oyalarni saqlash uchun tizimga kiring"):t.value||(t.value=!0,await r.ideas.favorite(e.id).then(a=>{l(a.data.idea),o.updateUserFavorites(a.data.user_favorites),o.hasFavoritedIdea(e)?w("G'oya muvaffaqiyatli saqlandi"):s("G'oya sizning sevimlilar ro'yxatingizdan o'chirildi")}).finally(()=>{t.value=!1}))}async function Y(e,a){if(o.isGuest)s("Iltimos, sharh qoldirish uchun tizimga kiring");else if(!t.value){if(!e)return;await e.validate(async(n,m)=>{n&&(t.value=!0,await r.ideas.comment(a.idea.id,{body:a.body,parent_id:a.parent_id??null}).then(p=>{l(p.data.idea),o.updateUserComments(p.data.user_comments)}).finally(()=>{t.value=!1}))})}}function $(e){}function C(){return o.isGuest?(s("Ovoz berish uchun tizimga kiring"),!1):!0}async function E(e,a){t.value=!0,await r.ideas.vote(e.id,{type:a}).then(n=>{l(n.data.idea),o.updateUserVotes(n.data.user_votes),s("Ovoz berildi")}).finally(()=>{t.value=!1})}return(e,a)=>{const n=J,m=A,p=L;return d(),c(Q,null,{header:y(()=>[v(i(X),{title:"G'oyalar"})]),default:y(()=>[v(n,{right:50,bottom:50,"visibility-height":300}),v(p,null,{default:y(()=>[v(m,null,{default:y(()=>[v(W,{onShowModal:i(h)},null,8,["onShowModal"]),(d(!0),D(ae,null,ee(i(u),f=>(d(),c(K,{key:f.id,idea:f,submitting:t.value,onShowEditModalHandler:i(b),onShowCommentModalHandler:i(k),onDeleteIdeaHandler:N,onVoteUpHandler:O,onVoteDownHandler:P,onFavoriteIdeaHandler:R,onSendIdeaHandler:$},null,8,["idea","submitting","onShowEditModalHandler","onShowCommentModalHandler"]))),128)),te("div",{ref_key:"landmark",ref:_},null,512)]),_:1})]),_:1}),i(q)?(d(),c(H,{key:0,"idea-form":i(I),submitting:t.value,title:"Yangi g'oya","submit-button-text":"Yuborish",onClose:a[0]||(a[0]=f=>i(h)(!1)),onSubmit:M,onReset:i(S)},null,8,["idea-form","submitting","onReset"])):g("",!0),i(U)?(d(),c(H,{key:1,"idea-form":i(I),submitting:t.value,title:"G'oyani tahrirlash","submit-button-text":"Saqlash",onClose:a[1]||(a[1]=f=>i(b)(!1)),onSubmit:M,onReset:i(S)},null,8,["idea-form","submitting","onReset"])):g("",!0),i(z)?(d(),c(Z,{key:2,"idea-comment-form":i(x),submitting:t.value,"submit-button-text":"Yuborish",onClose:a[2]||(a[2]=f=>i(k)(!1)),onSubmit:Y},null,8,["idea-comment-form","submitting"])):g("",!0)]),_:1})}}};export{Me as default};
